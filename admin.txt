    -- ===================================================================
-- INITIALIZATION
-- ===================================================================
local Players = game:GetService("Players")
local LocalPlayer = Players.LocalPlayer
local screenGui = Instance.new("ScreenGui")

screenGui.Name = "PurpleUI-Modal"
screenGui.ResetOnSpawn = false
screenGui.ZIndexBehavior = Enum.ZIndexBehavior.Sibling
screenGui.Parent = game.CoreGui
local function MakeRound(frame, radius)
    local corner = Instance.new("UICorner")
    corner.CornerRadius = UDim.new(0, radius or 8)
    corner.Parent = frame
    return corner
end

local function AddStroke(frame, color, thickness)
    local stroke = Instance.new("UIStroke")
    stroke.Color = color or Theme.Border
    stroke.Thickness = thickness or 1
    stroke.ApplyStrokeMode = Enum.ApplyStrokeMode.Border
    stroke.Parent = frame
    return stroke
end
local Theme = {
    Background = Color3.fromRGB(20, 15, 30),
    Sidebar = Color3.fromRGB(30, 20, 45),
    Primary = Color3.fromRGB(130, 80, 200),
    Secondary = Color3.fromRGB(100, 60, 170),
    Accent = Color3.fromRGB(160, 100, 230),
    Text = Color3.fromRGB(255, 255, 255),
    TextDim = Color3.fromRGB(180, 180, 200),
    Border = Color3.fromRGB(80, 60, 120),
    Input = Color3.fromRGB(40, 30, 60),
    Success = Color3.fromRGB(100, 200, 130),
    Warning = Color3.fromRGB(230, 180, 80)
}
local function ShowAlertModal(message)
    
    local Modal = Instance.new("Frame")
    Modal.BackgroundTransparency = 0.7
    Modal.BackgroundColor3 = Color3.new(0, 0, 0)
    Modal.Size = UDim2.new(1, 0, 1, 0)
    Modal.ZIndex = 1000
    Modal.Parent = screenGui

    local ModalBox = Instance.new("Frame")
    ModalBox.Size = UDim2.new(0, 280, 0, 100)
    ModalBox.Position = UDim2.new(0.5, -140, 0.5, -50)
    ModalBox.BackgroundColor3 = Theme.Input
    ModalBox.BorderSizePixel = 0
    ModalBox.ZIndex = 1001
    ModalBox.Parent = Modal
    MakeRound(ModalBox, 10)
    AddStroke(ModalBox, Theme.Border, 1)

    local MessageLabel = Instance.new("TextLabel")
    MessageLabel.Size = UDim2.new(1, -20, 0, 30)
    MessageLabel.Position = UDim2.new(0, 10, 0, 12)
    MessageLabel.BackgroundTransparency = 1
    MessageLabel.Text = message
    MessageLabel.TextColor3 = Theme.Text
    MessageLabel.TextSize = 14
    MessageLabel.Font = Enum.Font.Gotham
    MessageLabel.TextWrapped = true
    MessageLabel.ZIndex = 1002
    MessageLabel.Parent = ModalBox

    local YesBtn = Instance.new("TextButton")
    YesBtn.Size = UDim2.new(0, 80, 0, 30)
    YesBtn.Position = UDim2.new(0.5, -40, 1, -38)
    YesBtn.Text = "Ok"
    YesBtn.TextColor3 = Color3.fromRGB(240, 240, 245)
    YesBtn.BackgroundColor3 = Color3.fromRGB(200, 60, 80)
    YesBtn.Font = Enum.Font.GothamBold
    YesBtn.ZIndex = 1002
    YesBtn.Parent = ModalBox
    MakeRound(YesBtn, 5)

   

    YesBtn.MouseButton1Click:Connect(function()
        Modal:Destroy()
    end)
end

-- local UI = loadstring(game:HttpGet("https://lua.cloudlabx.online/scripts/nich_ui.NiCH"))()
local UI = loadstring(game:HttpGet("https://raw.githubusercontent.com/06mrx/fishit/refs/heads/main/nich_ui.lua"))()

local playerGui = LocalPlayer:WaitForChild("PlayerGui")
if not  playerGui:FindFirstChild("NiCH_Hub_Glass") then
    
    -- ===================================================================
    -- FISHING SCRIPT - OPTIMIZED AND REFACTORED VERSION
    -- ===================================================================

    -- SERVICES
    -- ===================================================================
    
    local ReplicatedStorage = game:GetService("ReplicatedStorage")
    local HttpService = game:GetService("HttpService")
    local VirtualUser = game:GetService("VirtualUser")
    local StarterGui = game:GetService("StarterGui")
    local Workspace = game:GetService("Workspace")
    local Lighting = game:GetService("Lighting")
    local RunService = game:GetService("RunService")
    local UserInputService = game:GetService("UserInputService")
    local Stats = game:GetService("Stats")
    local TweenService = game:GetService("TweenService")

    -- ===================================================================
    -- GLOBAL VARIABLES AND CONFIG
    -- ===================================================================

    -- local isHideActive = false
    local customName = "NiCH Hub" -- Nama pengganti
    local customLevel = "Adalah Pokoknya"   -- Level pengganti
    local hideNameConnections = {} -- Tabel untuk menyimpan semua koneksi event agar bisa dibersihkan
    local selectedTotemID

    -- Aggressive Performance Mode Variables
    local isAggressivePerfActive = false
    local originalAggressiveSettings = {}
    local aggressivePerfConnections = {}

    
    local g_character = LocalPlayer.Character or LocalPlayer.CharacterAdded:Wait()
    local g_humanoid = g_character:WaitForChild("Humanoid")
    local g_animator = g_humanoid:FindFirstChildOfClass("Animator") or Instance.new("Animator", g_humanoid)

    -- Platform & Fishing State
    local platform = nil
    local isFishing = false
    local fishingActive = false
    local currentFishingLocation = nil
    local moved = false
    local instantFishCycleCount = 0
    local blatantFishCycleCount = 0
    local lastTimeBaitSpawned = nil
    local lastTimeFishCaught = nil
    local lastTimeBaitSpawnedOnlyFeature = os.clock()
    local lastRarity = nil
    local fishNameToFind = ""
    local oldLocation = nil
    local atMegalodon = false
    local megalodonTask
    local walkOnWaterConnection = nil
    -- local isWalkOnWater = false
    local waterPlatform = nil

    -- Device Detection
    -- local isMobile = UserInputService.TouchEnabled and not UserInputService.KeyboardEnabled
    local isMobile = UserInputService:GetPlatform() == Enum.Platform.Android
        or UserInputService:GetPlatform() == Enum.Platform.IOS
    local fullExecutor = false
    local executor = getgenv().identifyexecutor and (getgenv().identifyexecutor()) or game["Run Service"]:IsStudio() and (game["Run Service"]:IsServer() and "Server" or "Client").."StudioApp" or game["Run Service"]:IsServer() and "Server" or "Client"
    local isAdmin = false
    local WhitelistExecutor = {
        Bunni = true,
        Ronix = true
    }
    if WhitelistExecutor[executor] then
        fullExecutor = true
    end
    
    -- if executor == "Bunni" then isMobile = true end
    -- Controllers (Mobile Only)
    local Controllers, NotificationController, GiftingController, TextNotificationController, VFXController, CutsceneController, ControlModule, FishingController, PromptController, BackpackController
    local Replion, PlayerData, ItemUtility, TierUtility

    -- Task References
    local blatantFishingTask, totemsTask, totemTask, weatherTask, autoSellTask, autoSendEvolveEnchantTask, caveCrystalTask
    local heartbeatConnection, Noclipping

    -- Animation Variables
    local AnimationsFolder = ReplicatedStorage:WaitForChild("Modules"):WaitForChild("Animations")
    local Override = {}
    local g_selectedSkin = "Holy Trident - "
    local skinPrefix = ""

    -- UI References
    local Rayfield, Window

    -- Event Connections
    local Events = {}
    local exclaimConnection, baitConnection, fishNotifConnection, fishCaughtConn

    local isExclaim = false
    -- Configuration
    local mutationTarget = {}
    local Config = {
        MainLoop = true,
        InstantFishing = false,
        InstantPerfectFishing = false,
        BlatantFishing = false,
        AutoCatch = false,
        Perfection = false,
        isFarming = false,
        AutoFarm = false,
        AutoFarmMegalodon = false,
        AutoFarmChristmas = false,
        AutoFavorite = false,
        CatchDelay = 0.7,
        CastDelay = 1.12,
        ChargeDelay = 0,
        CancelDelay = 0.7,
        DisableAnimations = false,
        PerfectionValue = 0.296,
        onlyMythicAndSecret = false,
        onlyRareAndEpic = false,
        onlySecret = false,
        autoWeather = false,
        removePopUp = false,
        antiFall = false,
        gpuSaver = false,
        customEffect = false,
        AutoSell = true,
        SellDelay = 15,
        SpeedHack = false,
        SpeedHackValue = 60,
        WalkOnWater = false,
        HookNotif = false,
        BackupPerfection = false,
        AutoTradeEvolveEnchant = false,
        AutoAcceptTrade = false,
        AutoSendTrade = false,
        FavRubyGemstone = false,
        isFreeze = false,
        backupIsFreeze = false,
        autoFishing = false,
        DisablePopUp = false,
        DisableVfx = false,
        DisableCutscene = false,    
        CustomWebhook = false,
        WebhookUrl = "https://discord.com/api/webhooks/1461727812917526681/PY7QeWuw4dHp8NmurEcHiLMJIx06Akxwpna_wpWXA1QKayarcy4W73k25gtrpHQ77pq5",
        CustomWebhookUrl = "",
        HideUsn = false,
        AutoMining = false,
        axeUuid = "",
        autoConsumeCaveCrystal = false,
        savePosition = false,
        position = "",
        antiOKOK = false,
        SpinPlayer = false
    }

    -- Rarity Options
    local targetRarities = {
        mythic = false,
        legendary = false,
        epic = false,
        rare = false,
        uncommon = false
    }

    local targetWebhookRarities = {
        mythic = false,
        legendary = false,
        epic = false,
        rare = false,
        uncommon = false
    }

    local Config = table.clone(Config)
    local CONFIG_FILE = "config_nich2.json"
    local MUTATION_CONFIG = "mutation_config_nich2.json"
    local RARITY_CONFIG = "rarity_config_nich2.json"
    local RARITY_WH_CONFIG = "rarity_wh_config_nich2.json"
    -- targetWebhookRarities
    --==================================================
    -- LOAD & SAVE CONFIG
    --==================================================
    local function LoadConfig()
        -- print("loading Config")
        task.spawn(function()
            if isfile(CONFIG_FILE) then
                local ok, data = pcall(function()
                    return HttpService:JSONDecode(readfile(CONFIG_FILE))
                end)
                if ok and typeof(data) == "table" then
                    for k, v in pairs(data) do
                        if Config[k] ~= nil then
                            Config[k] = v
                            print(k,v)
                        end
                    end
                end
                print("xsuccess 1")
            end
        end)

        task.spawn(function()
            if isfile(MUTATION_CONFIG) then
                print("ada config mutasi")
            
                local ok, data = pcall(function()
                    return HttpService:JSONDecode(readfile(MUTATION_CONFIG))
                end)
            
                if not ok then
                    warn("JSONDecode error:", data)
                    return false
                end
            
                if typeof(data) ~= "table" then
                    warn("data bukan table:", typeof(data))
                    return false
                end
            
                -- DEBUG ISI
                print("data type:", typeof(data))
                print("data length:", #data)
            
                table.clear(mutationTarget)
            
                for i, v in ipairs(data) do
                    print("load mutation:", i, v, typeof(v))
                    mutationTarget[i] = v
                end
            
                print("mutationTarget loaded:", #mutationTarget)
                return true
            end
        end)

        task.spawn(function()
            if isfile(RARITY_CONFIG) then
                local ok, data = pcall(function()
                    return HttpService:JSONDecode(readfile(RARITY_CONFIG))
                end)
                if ok and typeof(data) == "table" then
                    for k, v in pairs(data) do
                        if targetRarities[k] ~= nil then
                            targetRarities[k] = v
                        end
                    end
                end
                print("xsuccess 3")
            end
        end)

        task.spawn(function()
            if isfile(RARITY_WH_CONFIG) then
                local ok, data = pcall(function()
                    return HttpService:JSONDecode(readfile(RARITY_WH_CONFIG))
                end)
                if ok and typeof(data) == "table" then
                    for k, v in pairs(data) do
                        if targetWebhookRarities[k] ~= nil then
                            targetWebhookRarities[k] = v
                        end
                    end
                end
                print("xsuccess 4")
            end
        end)

        
    end

    local function SaveConfig(type)
        -- 1 config
        -- 2 mutation target
        -- 3 
        if type == 1 then
            writefile(CONFIG_FILE, HttpService:JSONEncode(Config))
        elseif type == 2 then
            writefile(MUTATION_CONFIG, HttpService:JSONEncode(mutationTarget))
        elseif type == 3 then
            writefile(RARITY_CONFIG, HttpService:JSONEncode(targetRarities))
        elseif type == 4 then
            writefile(RARITY_WH_CONFIG, HttpService:JSONEncode(targetWebhookRarities))
        end
    end

    local function SaveAllConfig()
        SaveConfig(1)
        SaveConfig(2)
        SaveConfig(3)
        SaveConfig(4)
    end

    LoadConfig()
    -- updateSkipMode()
    -- Animation Skins
    local skins = {
        -- "Default - ",
        "Holy Trident - ",
        "1x1x1x1 Ban Hammer - ",
        "Corruption Edge - ",
        "Eclipse Katana - ",
        -- "Frozen Krampus Scythe - ",
    }


    local backupTargetRarities = {
        mythic = false,
        legendary = false,
        epic = false,
        rare = false,
        uncommon = false
    }
    local isSkipMode = false
    local function updateSkipMode()
        isSkipMode = false
        for _, value in pairs(targetRarities) do
            if value == true then
                isSkipMode = true
                return
            end
        end
    end
    updateSkipMode()

    -- Weather Options
    local weatherOptions = {"Storm", "Cloudy", "Snow", "Wind", "Radiant"}
    local weatherQueue = {}



    -- Locations
    local LOCATIONS = {
        ["Fisherman"] = CFrame.new(-18.065, 9.532, 2734.000, -0.113811, 0.000000, -0.993502, -0.000000, 1.000000, 0.000000, 0.993502, 0.000000, -0.113811),
        ["Sisyphus Statue"] = CFrame.new(-3754.441, -135.074, -895.376, 0.943844, 0, -0.330393, 0, 1, 0, 0.330393, 0, 0.943844),
        ["Coral Reefs"] = CFrame.new(-3030.043, 2.509, 2271.429, 0.304264, -0.000000, 0.952588, -0.000000, 1.000000, 0.000000, -0.952588, -0.000000, 0.304264),
        ["Esoteric Depths"] = CFrame.new(3271.979, -1301.530, 1402.762, -0.981542, -0.000000, -0.191249, -0.000000, 1.000000, 0.000000, 0.191249, 0.000000, -0.981542),
        ["Crater Island 1"] = CFrame.new(990.610, 21.142, 5060.255, 0.998865, 0.000000, -0.047632, -0.000000, 1.000000, -0.000000, 0.047632, 0.000000, 0.998865),
        ["Crater Island 2"] = CFrame.new(1040.036, 55.714, 5131.443, 0.551438, -0.000000, 0.834216, 0.000000, 1.000000, 0.000000, -0.834216, 0.000000, 0.551438),
        -- ["Cristmas Island"] = CFrame.new(1150.656, 23.544, 1531.281, -0.963954, 0.000000, -0.266071, 0.000000, 1.000000, -0.000000, 0.266071, -0.000000, -0.963954),
        -- ["Christmas Cave 1"] = CFrame.new(552.176, -580.581, 8843.212, -0.872469, -0.000000, -0.488669, -0.000000, 1.000000, -0.000000, 0.488669, -0.000000, -0.872469),
        -- ["Christmas Cave 2"] = CFrame.new(572.219, -500.855, 8891.154, 0.908322, 0.000000, -0.418273, -0.000000, 1.000000, -0.000000, 0.418273, 0.000000, 0.908322),
        ["Lost Isle"] = CFrame.new(-3618.15698, 240.836655, -1317.45801),
        ["Weather Machine"] = CFrame.new(-1488.51196, 83.1732635, 1876.30298),
        ["Tropical Grove"] = CFrame.new(-2132.597, 53.488, 3631.235, -0.664326, -0.000000, 0.747443, -0.000000, 1.000000, 0.000000, -0.747443, -0.000000, -0.664326),
        -- ["Mount Hallow"] = CFrame.new(2136.62305, 78.9163895, 3272.50439),
        ["Treasure Room"] = CFrame.new(-3630, -279.074, -1599.287, 0.721647, 0, -0.692261, 0, 1, 0, 0.692261, 0, 0.721647),
        ["Kohana"] = CFrame.new(-663.904236, 3.04580712, 718.796875),
        ["Kohana2"] = CFrame.new(-530.529, 8.750, -72.149, -0.910784, 0, -0.412883, 0, 1, 0, 0.412883, 0, -0.910784),
        ["Underground Cellar"] = CFrame.new(2110.109, -91.199, -699.790, 0.744219, -0.000000, -0.667935, -0.000000, 1.000000, -0.000000, 0.667935, 0.000000, 0.744219),
        ["Ancient Jungle"] = CFrame.new(1837.352, 5.894, -297.224, 0.388620, 0.000000, -0.921398, 0.000000, 1.000000, 0.000000, 0.921398, -0.000000, 0.388620),
        ["Ancient Jungle 2"] = CFrame.new(1468.971, 6.512, -326.397, -0.458676, 0.000000, -0.888603, 0.000000, 1.000000, 0.000000, 0.888603, -0.000000, -0.458676),
        ["Sacred Temple"] = CFrame.new(1459.217, -22.375, -637.787, 0.924266, 0, 0.381750, 0, 1, 0, -0.381750, 0, 0.924266),
        ["Ancient Ruins"] = CFrame.new(6097.176, -585.924, 4644.443, -0.514758, 0, 0.857336, 0, 1, 0, -0.857336, 0, -0.514758),
        -- ["Iron Cavern"] = CFrame.new(-8796.534, -585, 226.230, -0.618126, 0, -0.786079, 0, 1, 0, 0.786079, 0, -0.618126),
        ["Megalodon"] = CFrame.new(-1172.987, 7.924, 3620.589, 0.706693, 0, 0.707521, 0, 1, 0, -0.707521, 0, 0.706693),
        ["Pirate Cove"] = CFrame.new(3396.730, 4.192, 3469.213) * CFrame.Angles(-0.000, -1.447, -0.000),
        ["Pirate Treasure Room"] = CFrame.new(3324.07397, -306.475647, 3087.99927, 0.999340534, -1.78439805e-08, 0.0363113917, 2.01013268e-08, 1, -6.18013019e-08, -0.0363113917, 6.24904501e-08, 0.999340534),
        ["Secret Passage"] = CFrame.new(3436.101, -289.845, 3382.640, -0.920254, 0.000000, -0.391321, 0.000000, 1.000000, 0.000000, 0.391321, -0.000000, -0.920254),
        ["Kohana Volcano"] =  CFrame.new(-549.192, 20.019, 125.802, 0.955081, 0.000000, -0.296344, -0.000000, 1.000000, 0.000000, 0.296344, -0.000000, 0.955081),
        ["Crystal Depth"] = CFrame.new(5752.219, -907.148, 15343.468, -0.628654, 0.000000, 0.777685, -0.000000, 1.000000, -0.000000, -0.777685, -0.000000, -0.628654),
    }

    -- Constants
    local SAFE_DISTANCE = 11
    local factor = 1.01
    local RELATIVE_POINTS = {
        Vector3.new(356.397-307.258, 10.420-7.597, 2667.315-2667.414) * factor,
        Vector3.new(269.795-307.258, 10.420-7.597, 2717.315-2667.414) * factor,
        Vector3.new(269.795-307.258, 10.420-7.597, 2617.315-2667.414) * factor
    }
    local HEIGHT_ABOVE = 101
    local HEIGHT_BELOW = 102
    local points = {}
    local totemUUIDs = {}
    local GLOBAL_WEBHOOK_URL = "https://discord.com/api/webhooks/1461727812917526681/PY7QeWuw4dHp8NmurEcHiLMJIx06Akxwpna_wpWXA1QKayarcy4W73k25gtrpHQ77pq5"
    -- Connections
    local connections = {}
    local Original = {}
    local UICache = {} -- [ui] = originalParent
    local PartColorCache = {}
    -- local whitelistedName = {
    --     "mrx",
    --     "luxxferrenich",
    --     "akunwangi666x",
    --     "donutsschocoo",
    --     "xcztalon2",
    --     "xnmzxc28"
    -- }
    local whitelistedName = {
        "666chickiwings",
        "inidiayangkumaoo",
        "akunwangi666x",
        "donutsschocoo",
        "xcztalon2",
        "xnmzxc28",
        -- "finecooks,",
        -- "ziarusshel",
        -- "shinzz2324",
        -- "yanzrawr1",
        -- "azuraxaan",
        -- "arya4youraya1",
        -- "ickiwir91",
        -- "willzz_2329",
        -- "muffines",
        -- "mupincuek",
        -- "mupinnich"
    }


    local specialNotifdName = {
        "fineCooks",
        "ziarussheL",
        "shinzz2324",
        "yanzRawr1",
        "azuraxaan",
    }

    local function isSpecialNotif(displayName)
        displayName = string.lower(displayName)
        -- print("checking : " .. displayName)
        for _, name in ipairs(specialNotifdName) do
            -- print("matching " .. name)
            if string.find(displayName, name, 1, true) then
                return true
            end
        end

        return false
    end

    local animationConnection, equipRodSkinConnection, unEquipRodSkinConnection
    local noFallConnection, characterAddedConnection
    local flyConnection, FlyForce

    local Promise
    if isMobile or fullExecutor then
        Controllers = ReplicatedStorage:WaitForChild("Controllers")
        NotificationController = require(Controllers:WaitForChild("NotificationController"))
        GiftingController = require(Controllers:WaitForChild("GiftingController"))
        TextNotificationController = require(Controllers:WaitForChild("TextNotificationController"))
        VFXController = require(Controllers:WaitForChild("VFXController"))
        FishingController = require(Controllers:WaitForChild("FishingController"))
        PromptController = require(Controllers:WaitForChild("PromptController"))
        BackpackController = require(Controllers:WaitForChild("BackpackController"))
        CutsceneController = require(Controllers:WaitForChild("CutsceneController"))
        Replion = require(ReplicatedStorage.Packages.Replion)
        PlayerData = Replion.Client:WaitReplion("Data")
        ControlModule = require(LocalPlayer:WaitForChild("PlayerScripts"):WaitForChild("PlayerModule"):WaitForChild("ControlModule"))
        Promise = require(ReplicatedStorage:WaitForChild("Packages").Promise)
        ItemUtility = require(ReplicatedStorage.Shared.ItemUtility)
        TierUtility = require(ReplicatedStorage:WaitForChild("Shared"):WaitForChild("TierUtility"))

        print("mobile")
    else
        print("ðŸ’» Player menggunakan PC / Laptop")
    end


    local function printTable(tbl, indent)
        indent = indent or 0
        local spacing = string.rep("  ", indent)

        for key, value in pairs(tbl) do
            if type(value) == "table" then
                print(spacing .. tostring(key) .. " = {")
                printTable(value, indent + 1)
                print(spacing .. "}")
            else
                print(spacing .. tostring(key) .. " = " .. tostring(value))
            end
        end
    end

    local function RemoveValue(tbl, value)
        for i, v in ipairs(tbl) do if v == value then table.remove(tbl, i) break end end
    end
    -- storage backup (weak table biar aman)
    local _backup = setmetatable({}, { __mode = "k" })

    local function DisableController(controller)
        if _backup[controller] then
            return -- sudah di-disable
        end

        local data = {
            functions = {},
            metatable = getmetatable(controller),
        }

        -- backup & overwrite functions
        for k, v in pairs(controller) do
            if type(v) == "function" then
                data.functions[k] = v
                controller[k] = function() end
            end
        end

        -- hook metatable
        local mt = data.metatable or {}
        mt.__index = function(_, key)
            if data.functions[key] then
                return function() end
            end
            return nil
        end
        mt.__newindex = function() end

        setmetatable(controller, mt)
        _backup[controller] = data
    end
    local function equipRod()
        Events.equip:FireServer(1)
        Events.equip:FireServer(1)
        Events.equip:FireServer(1)
        Events.equip:FireServer(1)
                -- castRod()
        if Config.InstantFishing then
            castRod()
        end
        if Config.autoFishing then
            DisableController(FishingController)
            Events.UpdateAutoFishingState:InvokeServer(true)
        end
    end
    local function getRootPart()
        local character = LocalPlayer.Character
        if not character then return end
        local rootPart = character:FindFirstChild("HumanoidRootPart")
        return rootPart
    end
    local function getHrp()
        local character = LocalPlayer.Character            
        local hrp = character:FindFirstChild("HumanoidRootPart")
        return hrp
    end
    local PlayerDataReplion = nil
    local function GetPlayerDataReplion()
        if PlayerDataReplion then return PlayerDataReplion end
        local ReplionModule = ReplicatedStorage:WaitForChild("Packages"):WaitForChild("Replion", 10)
        if not ReplionModule then return nil end
        local ReplionClient = require(ReplionModule).Client
        PlayerDataReplion = ReplionClient:WaitReplion("Data", 5)
        return PlayerDataReplion
    end
    local MerchantReplion = nil
    local function GetReplions()
        if MerchantReplion then return true end
        local ReplionModule = ReplicatedStorage:WaitForChild("Packages"):WaitForChild("Replion", 10)
        if not ReplionModule then return false end
        local ReplionClient = require(ReplionModule).Client
        MerchantReplion = ReplionClient:WaitReplion("Merchant", 5)
        return MerchantReplion
    end

    -- if isMobile then
        local function GetItemMutationString(item)
            if item.Metadata and item.Metadata.Shiny == true then return "Shiny" end
            return item.Metadata and item.Metadata.VariantId or ""
        end
        local function GetFishNameAndRarity(item)
            local name = item.Identifier or "Unknown"
            local rarity = item.Metadata and item.Metadata.Rarity or "COMMON"
            local itemID = item.Id

            local itemData = nil

            if ItemUtility and itemID then
                pcall(function()
                    itemData = ItemUtility:GetItemData(itemID)
                    if not itemData then
                        local numericID = tonumber(item.Id) or tonumber(item.Identifier)
                        if numericID then
                            itemData = ItemUtility:GetItemData(numericID)
                        end
                    end
                end)
            end

            if itemData and itemData.Data and itemData.Data.Name then
                name = itemData.Data.Name
            end

            if item.Metadata and item.Metadata.Rarity then
                rarity = item.Metadata.Rarity
            elseif itemData and itemData.Probability and itemData.Probability.Chance and TierUtility then
                local tierObj = nil
                pcall(function()
                    tierObj = TierUtility:GetTierFromRarity(itemData.Probability.Chance)
                end)

                if tierObj and tierObj.Name then
                    rarity = tierObj.Name
                end
            end

            return name, rarity
        end
    -- end

    -- local mrx =1

    -- FUNGSI UNTUK MENDAPATKAN DETAIL ITEM LENGKAP
    local function GetMerchantStockDetails(merchantData)
        local itemDetails = {}
        local MarketItemData =  require(ReplicatedStorage.Shared.MarketItemData)
        
        if merchantData and merchantData.Items and type(merchantData.Items) == "table" and MarketItemData and ItemUtility then
            for _, itemID in ipairs(merchantData.Items) do
                local marketData = nil
                for _, data in ipairs(MarketItemData) do
                    if data.Id == itemID then marketData = data; break end
                end

                if marketData and not marketData.SkinCrate and marketData.Price and marketData.Currency then
                    local itemDetail = nil
                    pcall(function() itemDetail = ItemUtility:GetItemDataFromItemType(marketData.Type, marketData.Identifier) end)
                    
                    local name = (itemDetail and itemDetail.Data and itemDetail.Data.Name) or marketData.Identifier or "Unknown Item"
                    
                    table.insert(itemDetails, {
                        Name = name,
                        ID = itemID,
                        Price = marketData.Price,
                        Currency = marketData.Currency,
                    })
                end
            end
        end
        return itemDetails
    end
    local function FormatNumber(n)
            if n >= 1000000000 then return string.format("%.1fB", n / 1000000000)
            elseif n >= 1000000 then return string.format("%.1fM", n / 1000000)
            elseif n >= 1000 then return string.format("%.1fK", n / 1000)
            else return tostring(n) end
        end

    local function freezePlayer(status)
        Config.isFreeze = status
        local hrp = getHrp()
        if status then
            hrp.Velocity = Vector3.new(0,0,0)
            hrp.AssemblyLinearVelocity = Vector3.new(0,0,0)
            hrp.Anchored = true
        else
            hrp.Anchored = false
        end
    end

    local function EnableController(controller)
        local data = _backup[controller]
        if not data then
            return -- belum pernah di-disable
        end

        -- restore functions
        for k, v in pairs(data.functions) do
            controller[k] = v
        end

        -- restore metatable
        setmetatable(controller, data.metatable)

        _backup[controller] = nil
    end

    local function EnableAutoAcceptTrade()
        if PromptController and PromptController.FirePrompt and Promise then
            local oldFirePrompt = PromptController.FirePrompt
            PromptController.FirePrompt = function(self, promptText, ...)
                
                if Config.AutoAcceptTrade and type(promptText) == "string" and promptText:find("Accept") and promptText:find("from:") then
                    
                    -- local initiatorName = string.match(promptText, "from: ([^\n]+)") or "Seseorang"
                    
                    
                    return Promise.new(function(resolve)
                        task.wait(2)
                        resolve(true)
                    end)
                end
                
                return oldFirePrompt(self, promptText, ...)
            end
        else
            warn("[RockHub] Gagal memuat PromptController/Promise untuk Auto Accept Trade.")
        end

    end

    local function EnableAutoSendTrade()
        if PromptController and PromptController.FirePrompt and Promise then
            local oldFirePrompt = PromptController.FirePrompt
            PromptController.FirePrompt = function(self, promptText, ...)
                print(promptText)
                if Config.AutoSendTrade and type(promptText) == "string"  and promptText:find("Would you") then
                    
                    -- local initiatorName = string.match(promptText, "from: ([^\n]+)") or "Seseorang"
                    
                    
                    return Promise.new(function(resolve)
                        task.wait(2)
                        resolve(true)
                    end)
                end
                
                return oldFirePrompt(self, promptText, ...)
            end
        else
            warn("[RockHub] Gagal memuat PromptController/Promise untuk Auto Accept Trade.")
        end

    end

    local itemToTradeIds = {}


    -- Load override animations
    local function loadAnimations(skinPrefix)
        local anims = {}
        for _, animName in ipairs({"FishCaught", "ReelStart", "RodThrow", "ReelingIdle"}) do
            anims[animName] = g_animator:LoadAnimation(AnimationsFolder:WaitForChild(skinPrefix .. animName))
            anims[animName].Priority = Enum.AnimationPriority.Action
        end
        return anims
    end
    print("loadAnimations")
    -- Initialize network events
    local function initNetworkEvents()
        local success = pcall(function()
            local net = ReplicatedStorage:WaitForChild("Packages", 10):WaitForChild("_Index", 10):WaitForChild("sleitnick_net@0.2.0", 10):WaitForChild("net", 10)
            Events = {
                fishing = net:WaitForChild("RF/CatchFishCompleted", 1),
                baitSpawned = net:WaitForChild("RE/BaitSpawned", 1),
                sell = net:WaitForChild("RF/SellAllItems", 1),
                charge = net:WaitForChild("RF/ChargeFishingRod", 1),
                minigame = net:WaitForChild("RF/RequestFishingMinigameStarted", 1),
                equip = net:WaitForChild("RE/EquipToolFromHotbar", 1),
                unequip = net:WaitForChild("RE/UnequipToolFromHotbar", 1),
                equipItem = net:WaitForChild("RE/EquipItem", 1),
                unEquipItem = net:WaitForChild("RE/UnequipItem", 1),
                equipRodSkin = net:WaitForChild("RE/EquipRodSkin", 10),
                unEquipRodSkin = net:WaitForChild("RE/UnequipRodSkin", 10),
                favorite = net:WaitForChild("RE/FavoriteItem", 1),
                exclaimEvent = net:WaitForChild("RE/ReplicateTextEffect", 1),
                fishNotif = net:WaitForChild("RE/ObtainedNewFishNotification", 1),
                systemMessageEvent = net:WaitForChild("RE/DisplaySystemMessage", 1),
                CancelFishingInputs = net:WaitForChild("RF/CancelFishingInputs", 1),
                weather = net:WaitForChild("RF/PurchaseWeatherEvent", 1),
                fishCaught = net:WaitForChild("RE/FishCaught", 1),
                SpawnTotem = net:WaitForChild("RE/SpawnTotem", 1),
                UpdateAutoFishingState = net:WaitForChild("RF/UpdateAutoFishingState", 1),
                EquipOxygenTank = net:WaitForChild("RF/EquipOxygenTank", 10),
                UnequipOxygenTank = net:WaitForChild("RF/UnequipOxygenTank", 10),
                PurchaseMarketItem = net:WaitForChild("RF/PurchaseMarketItem", 10),
                TextNotification = net:WaitForChild("RE/TextNotification", 1),
                ConsumeCaveCrystal = net:WaitForChild("RF/ConsumeCaveCrystal", 1),
                PlayFishingEffect = net:WaitForChild("RE/PlayFishingEffect", 1),
            }
        end)
        
        -- if not success then
        --     Notify("Error", "Failed to initialize network events", 5)
        --     return false
        -- end
        
        return true
    end
    print("initNetworkEvents")
    initNetworkEvents()
    print("initNetworkEvents caled")

    -- local oldInvoke = Events.UpdateAutoFishingState.InvokeServer

    -- Events.UpdateAutoFishingState.InvokeServer = function(self, state)
    --     warn("AutoFishing state:", state, debug.traceback())
    --     return oldInvoke(self, state)
    -- end

    -- ===================================================================
    -- UTILITY FUNCTIONS
    -- ===================================================================
    -- GUI ROOT
    local NotifyGui = Instance.new("ScreenGui")
    NotifyGui.Name = "PurpleNotify"
    NotifyGui.ResetOnSpawn = false
    NotifyGui.Parent = LocalPlayer:WaitForChild("PlayerGui")

    local Holder = Instance.new("Frame", NotifyGui)
    Holder.Size = UDim2.new(0, 360, 1, 0)
    Holder.Position = UDim2.new(1, -380, 0, 20)
    Holder.BackgroundTransparency = 1

    local layout = Instance.new("UIListLayout", Holder)
    layout.Padding = UDim.new(0, 10)
    layout.HorizontalAlignment = Enum.HorizontalAlignment.Right
    layout.VerticalAlignment = Enum.VerticalAlignment.Top

 --==================================================
-- NOTIFY
--==================================================
local function Notify(title, text, duration, mode)
    duration = duration or 4
    mode = mode or "Default"

    local accentColor =
        mode == "Success" and Theme.Success or
        mode == "Warning" and Theme.Warning or
        Theme.Accent

    local card = Instance.new("Frame")
    card.Size = UDim2.new(1, -10, 0, 0)
    card.BackgroundColor3 = Theme.Background
    card.BorderColor3 = Theme.Border
    card.BorderSizePixel = 1
    card.Parent = Holder
    card.ClipsDescendants = true

    Instance.new("UICorner", card).CornerRadius = UDim.new(0, 10)

    local bar = Instance.new("Frame", card)
    bar.Size = UDim2.new(0, 4, 1, 0)
    bar.BackgroundColor3 = accentColor
    bar.BorderSizePixel = 0

    local titleLabel = Instance.new("TextLabel", card)
    titleLabel.Position = UDim2.new(0, 14, 0, 8)
    titleLabel.Size = UDim2.new(1, -20, 0, 22)
    titleLabel.Text = title
    titleLabel.TextColor3 = Theme.Text
    titleLabel.Font = Enum.Font.GothamBold
    titleLabel.TextSize = 14
    titleLabel.BackgroundTransparency = 1
    titleLabel.TextXAlignment = Enum.TextXAlignment.Left

    local textLabel = Instance.new("TextLabel", card)
    textLabel.Position = UDim2.new(0, 14, 0, 30)
    textLabel.Size = UDim2.new(1, -20, 0, 40)
    textLabel.TextWrapped = true
    textLabel.TextYAlignment = Enum.TextYAlignment.Top
    textLabel.Text = text
    textLabel.TextColor3 = Theme.TextDim
    textLabel.Font = Enum.Font.Gotham
    textLabel.TextSize = 13
    textLabel.BackgroundTransparency = 1
    textLabel.TextXAlignment = Enum.TextXAlignment.Left

    -- AUTO SIZE
    local height = titleLabel.TextBounds.Y + textLabel.TextBounds.Y + 28

    TweenService:Create(card, TweenInfo.new(0.35, Enum.EasingStyle.Quad, Enum.EasingDirection.Out), {
        Size = UDim2.new(1, -10, 0, height)
    }):Play()

    -- AUTO CLOSE
    task.delay(duration, function()
        TweenService:Create(card, TweenInfo.new(0.3), {
            Size = UDim2.new(1, -10, 0, 0),
            BackgroundTransparency = 1
        }):Play()
        task.wait(0.35)
        card:Destroy()
    end)
end


    local function walkOnWater()
    if not waterPlatform then
        waterPlatform = Instance.new("Part")
        waterPlatform.Name = "WaterPlatform"
        waterPlatform.Anchored = true
        waterPlatform.CanCollide = true
        waterPlatform.Transparency = 1 
        waterPlatform.Size = Vector3.new(15, 1, 15) -- Ukuran diperbesar sedikit
        waterPlatform.Parent = workspace
    end

    -- Pastikan koneksi lama mati dulu sebelum buat baru
    if walkOnWaterConnection then walkOnWaterConnection:Disconnect() end

        walkOnWaterConnection = game:GetService("RunService").RenderStepped:Connect(function()
            -- [FIX] Ambil Karakter TERBARU setiap frame
            local character = LocalPlayer.Character
            if not Config.WalkOnWater or not character then return end
            
            local hrp = character:FindFirstChild("HumanoidRootPart")
            if not hrp then return end

            -- Pastikan platform masih ada (kadang kehapus oleh game cleanup)
            if not waterPlatform or not waterPlatform.Parent then
                waterPlatform = Instance.new("Part")
                waterPlatform.Name = "WaterPlatform"
                waterPlatform.Anchored = true
                waterPlatform.CanCollide = true
                waterPlatform.Transparency = 1 
                waterPlatform.Size = Vector3.new(15, 1, 15)
                waterPlatform.Parent = workspace
            end

            local rayParams = RaycastParams.new()
            rayParams.FilterDescendantsInstances = {workspace.Terrain} 
            rayParams.FilterType = Enum.RaycastFilterType.Include -- MODE WHITELIST
            rayParams.IgnoreWater = false -- Pastikan Air terdeteksi

            -- Tembak dari ketinggian di atas kepala
            local rayOrigin = hrp.Position + Vector3.new(0, 5, 0) 
            local rayDirection = Vector3.new(0, -500, 0)

            local result = workspace:Raycast(rayOrigin, rayDirection, rayParams)

            -- 2. LOGIKA DETEKSI
            if result and result.Material == Enum.Material.Water then
                -- Jika menabrak AIR (Terrain Water)
                local waterSurfaceHeight = result.Position.Y
                
                -- Taruh platform tepat di permukaan air
                waterPlatform.Position = Vector3.new(hrp.Position.X, waterSurfaceHeight, hrp.Position.Z)
                
                -- Jika kaki player tenggelam sedikit di bawah air, angkat ke atas
                if hrp.Position.Y < (waterSurfaceHeight + 2) and hrp.Position.Y > (waterSurfaceHeight - 5) then
                        -- Cek input jump biar gak stuck pas mau loncat dari air
                    if not UserInputService:IsKeyDown(Enum.KeyCode.Space) then
                        hrp.CFrame = CFrame.new(hrp.Position.X, waterSurfaceHeight + 3.2, hrp.Position.Z)
                    end
                end
            else
                -- Sembunyikan platform jika di darat
                waterPlatform.Position = Vector3.new(hrp.Position.X, -500, hrp.Position.Z)
            end
        end)
    end
    local function predictColorWithOffset(textColor)
        textColor = tostring(textColor)
        local numbers = {}
        for num in string.gmatch(textColor, "[%d%.]+") do
            table.insert(numbers, tonumber(num))
        end

        local r, g, b = numbers[2], numbers[3], numbers[4]

        if r >= 0.7 and g <= 0.5 and b <= 0.5 then return "Merah"
        elseif r >= 0.7 and g >= 0.4 and b <= 0.2 then return "Orange"
        elseif r >= 0.6 and g >= 0.3 and b > 0.9 then return "Ungu"
        elseif g >= 0.8 and b >= 0.35 then return "Hijau tua"
        elseif g >= 0.8 and b <= 0.35 then return "Hijau muda"
        elseif b >= 0.9 then return "Biru"
        else
            if r > g and r > b then return "Merah"
            elseif g > r and g > b then return "Hijau"
            else return "Biru" end
        end
    end

    local function containsFish(obj)
        local ok, text = pcall(function() return obj.Text end)
        if ok and type(text) == "string" and string.find(text, fishNameToFind) then return true end
        if string.find(obj.Name, fishNameToFind) then return true end
        return false
    end

    local function monitorGui(gui)
        for _, obj in ipairs(gui:GetDescendants()) do
            task.spawn(function()
                if containsFish(obj) then
                    print("DIHAPUS:", obj:GetFullName())
                    obj:Destroy()
                end
            end)
        end
    end
    local defaultMaxZoom = LocalPlayer.CameraMaxZoomDistance or 128
    local zoomLoopConnection = nil
    local function infiniteZoom()
        defaultMaxZoom = LocalPlayer.CameraMaxZoomDistance
        
        -- 2. Paksa nilai zoom jadi besar
        LocalPlayer.CameraMaxZoomDistance = 100000
        
        -- 3. Pasang loop (RenderStepped) untuk memaksa nilai tetap besar
        -- Ini berguna kalau game mencoba mengembalikan zoom ke normal
        if zoomLoopConnection then zoomLoopConnection:Disconnect() end
        zoomLoopConnection = game:GetService("RunService").RenderStepped:Connect(function()
            LocalPlayer.CameraMaxZoomDistance = 100000
        end)
    end

    local function normalZoom()
        if zoomLoopConnection then 
            zoomLoopConnection:Disconnect() 
            zoomLoopConnection = nil
        end
        
        -- 2. Kembalikan ke nilai asli
        LocalPlayer.CameraMaxZoomDistance = defaultMaxZoom
    end

    -- ===================================================================
    -- PLATFORM FUNCTIONS
    -- ===================================================================
    local function createPlatform(position)
        if platform then return end
        platform = Instance.new("Part")
        platform.Name = "AirPlatform"
        platform.Size = Vector3.new(7, 1, 7)
        platform.Anchored = true
        platform.CanCollide = true
        platform.Transparency = 0.9
        platform.Position = position - Vector3.new(0, 3, 0)
        platform.Parent = workspace
    end

    local function removePlatform()
        if platform then
            platform:Destroy()
            platform = nil
        end
    end
    local originalWalkSpeed = 0
    local function toggleSpeedHack(enabled)
        local humanoid = LocalPlayer.Character.Humanoid
        if originalWalkSpeed == 0 then originalWalkSpeed = humanoid.WalkSpeed end
        
        if enabled then 
            humanoid.WalkSpeed = Config.SpeedHackValue
            if connections.speedChanged then connections.speedChanged:Disconnect() end
            connections.speedChanged = humanoid:GetPropertyChangedSignal("WalkSpeed"):Connect(function()
                if Config.SpeedHack and humanoid.WalkSpeed ~= Config.SpeedHackValue then
                    humanoid.WalkSpeed = Config.SpeedHackValue
                end
            end)
            -- Notify("Player", "Speedhack aktif!", 3)
        else
            if connections.speedChanged then
                connections.speedChanged:Disconnect()
                connections.speedChanged = nil
            end
            humanoid.WalkSpeed = originalWalkSpeed
            -- Notify("Player", "Speedhack nonaktif!", 3)
        end
    end

    local Camera = workspace.CurrentCamera
    local Speed = 80

    local function toggleFly(enabled)
        local character = LocalPlayer.Character or LocalPlayer.CharacterAdded:Wait()
        local hrp = character:WaitForChild("HumanoidRootPart")

        if enabled then
            FlyForce = Instance.new("BodyVelocity")
            FlyForce.MaxForce = Vector3.new(math.huge, math.huge, math.huge)
            FlyForce.P = 9e3
            FlyForce.Velocity = Vector3.zero
            FlyForce.Parent = hrp

            flyConnection = RunService.RenderStepped:Connect(function()
                local moveDir = ControlModule:GetMoveVector()
                local camCF = Camera.CFrame
                local velocity = Vector3.zero
                velocity += camCF.RightVector * moveDir.X * Speed
                velocity -= camCF.LookVector * moveDir.Z * Speed
                FlyForce.Velocity = velocity
            end)
        else
            if flyConnection then flyConnection:Disconnect() flyConnection = nil end
            if FlyForce then FlyForce:Destroy() FlyForce = nil end
        end
    end

    -- ===================================================================
    -- NO-FALL STATE MANAGEMENT
    -- ===================================================================
    local isNoFallActive = false

    local function startNoFall()
        if isNoFallActive then return end
        isNoFallActive = true
        noFallConnection = RunService.Heartbeat:Connect(function()
            local character = LocalPlayer.Character
            if not character then return end
            local root = character:FindFirstChild("HumanoidRootPart")
            local humanoid = character:FindFirstChild("Humanoid")
            if not root or not humanoid then return end

            if humanoid.FloorMaterial == Enum.Material.Air then
                createPlatform(root.Position)
            end

            if platform then
                local distance = (root.Position - platform.Position).Magnitude
                if distance > SAFE_DISTANCE then removePlatform() end
            end
        end)
    end

    local function stopNoFall()
        if not isNoFallActive then return end
        isNoFallActive = false
        if noFallConnection then noFallConnection:Disconnect() noFallConnection = nil end
        removePlatform()
    end

    -- ===================================================================
    -- TELEPORT FUNCTIONS
    -- ===================================================================
    local function teleport(cf)
        local char = LocalPlayer.Character
        if not char then return end
        local hrp = char:FindFirstChild("HumanoidRootPart")
        if not hrp then return end
        hrp.CFrame = cf + Vector3.new(0, 3, 0)
    end

    local function teleportToMegalodon()
        for _, obj in ipairs(workspace:GetDescendants()) do
            if string.find(obj.Name:lower(), "megalodon") then
                task.wait(0.1)
                if obj:IsA("BasePart") then
                    teleport(CFrame.new(obj.Position))
                    startNoFall()
                    atMegalodon = true
                    Config.isFarming = true
                    local rootpart = LocalPlayer.Character:FindFirstChild("HumanoidRootPart")
                    oldLocation = rootpart.CFrame
                    return
                end
            end
        end
    end

    local function teleportTo(locationName)
        local cframe = LOCATIONS[locationName]
        local character = LocalPlayer.Character
        if not character then return end
        local rootPart = character:FindFirstChild("HumanoidRootPart")
        if not rootPart then return end
        
        if string.find(locationName, "Megalodon") then
            teleportToMegalodon()
        else
            rootPart.CFrame = cframe
            if string.find(locationName, "Ruins") or string.find(locationName, "Christmas") then createPlatform(rootPart.Position) end
        end
        
        currentFishingLocation = cframe
    end

    -- ===================================================================
    -- FISHING FUNCTIONS
    -- ===================================================================
    local function castRod()
        pcall(function()
            Events.CancelFishingInputs:InvokeServer()
            task.wait(0.7)
            Events.charge:InvokeServer()
            task.wait(0.001)
            if g_selectedSkin ~= "Default" and Config.customEffect then
                Override.RodThrow = g_animator:LoadAnimation(AnimationsFolder:WaitForChild(g_selectedSkin .. "RodThrow"))
                Override.RodThrow:Play()
            end
            Events.minigame:InvokeServer(-911.1024780273438, 0.9, os.clock())
        end)
    end
    

    local function normalFishing()
        while Config.InstantFishing and not Config.BlatantFishing do
            if not isFishing then
                isFishing = true
                castRod()
                task.wait(Config.CastDelay)
                isFishing = false
            end
        end
    end

    local minigamex 
    local failcnt = 0
    local function blatantFishing()
        while Config.BlatantFishing do
            -- Events.fishing:InvokeServer()
            Events.CancelFishingInputs:InvokeServer()
            -- FishingController.RequestClientStopFishing(self,nil)
            task.wait(Config.CancelDelay)
            -- task.wait(0.7)
            -- if isExclaim then task.wait(0.6) end
            -- isExclaim =
            task.spawn(function()
                Events.charge:InvokeServer(0)
                -- task.wait(0.0466)
                -- if Config.antiOKOK then
                --     task.wait(math.random(2, 3) / 100)
                -- end
                -- for i = 1,2 do
                    minigamex = Events.minigame:InvokeServer(-0.9879989624023438, 0.9, tick())
                    -- if not minigamex then failcnt = failcnt + 1 end
                    
                    -- FishingController.SendFishingRequestToServer(self,-1, 1, 0)
                    -- print(minigamex)
                -- end
                -- task.wait(Config.CatchDelay)  
                if not skip then
                    -- blatantFishCycleCount += 1
                    -- Events.fishing:InvokeServer()
                end
                -- task.wait(0.3)
                -- Events.CancelFishingInputs:InvokeServer(0)
            end)
            -- if failcnt == 4 then Events.CancelFishingInputs:InvokeServer() task.wait(0.7) failcnt = 0 end
            -- Events.CancelFishingInputs:InvokeServer()
            task.wait(Config.CastDelay)
        end
    end
    local lastCast = 0
    local timestamp,now
    local function blatantFishingold()
        -- if isMobile or fullExecutor then
        --     local origCharge = FishingController.RequestChargeFishingRod
        --     local origCast = FishingController.SendFishingRequestToServer
        --     FishingController.RequestChargeFishingRod = function(...)
        --         if Config.BlatantFishing then return end
        --         return origCharge(...)
        --     end

        --     FishingController.SendFishingRequestToServer = function(...)
        --         if Config.BlatantFishing then return end
        --         return origCast(...)
        --     end

        --     local mt = getrawmetatable(game)
        --     local old_namecall = mt.__namecall
        --     setreadonly(mt, false)

            -- mt.__namecall = newcclosure(function(self, ...)
            --     local method = getnamecallmethod()
            --     if Config.BlatantFishing and not checkcaller() then
            --         -- Cegah game mengirim request mancing atau request update state
            --         if method == "InvokeServer" and (self.Name == "RequestFishingMinigameStarted" or self.Name == "ChargeFishingRod" or self.Name == "UpdateAutoFishingState") then
            --             return nil 
            --         end
            --         if method == "FireServer" and self.Name == "FishingCompleted" then
            --             return nil
            --         end
            --     end
            --     return old_namecall(self, ...)
            -- end)
            -- setreadonly(mt, true)

        -- end
        -- Events.charge:InvokeServer(nil,nil,nil, tick())
        -- Events.minigame:InvokeServer(-0.9879989624023438, 0.5, tick())
        -- task.wait(0.9)
        -- Events.fishing:InvokeServer()
        -- task.wait(0.3)
        while Config.BlatantFishing do
            if Config.CastDelay >= 1.25 then Events.CancelFishingInputs:InvokeServer() task.wait(0.075) end
            task.spawn(function()
                if Config.CastDelay <= 1.25 then Events.CancelFishingInputs:InvokeServer() end
                task.spawn(function()
                    -- if Config.CastDelay > 1.69 then
                    --     Events.charge:InvokeServer()
                    --     -- task.wait(0.1)
                    --     -- Events.charge:InvokeServer()
                        -- if Config.antiOKOK then
                        --     task.wait(math.random(15, 17) / 100)
                        -- end
                    -- else
                    --     task.spawn(function()
                    --         for  i = 1,3 do
                    --             Events.charge:InvokeServer()
                    --         end   
                    --     end)
                    -- end


                        Events.charge:InvokeServer(nil,nil,nil, Workspace:GetServerTimeNow())
                        if Config.antiOKOK then
                            task.wait(math.random(13, 15) / 100)
                        end
                        task.wait(0.01)
                        local res = Events.minigame:InvokeServer(-0.9879989624023438, 0.5, Workspace:GetServerTimeNow())
                        if res then needCast = false end

                    -- FishingController.RequestChargeFishingRod(self, 454, 215)
                    
                    
                    -- if Config.CastDelay > 1.69 then task.wait(math.random(12, 15) / 100) end
                    -- task.wait(math.random(12, 15) / 100)
                    -- Events.minigame:InvokeServer(0,0,0)
                    -- while not res do
                    --     res = Events.minigame:InvokeServer(-0.9879989624023438, 0.5, tick())
                    --     print(res)
                    -- end
                    -- FishingController.SendFishingRequestToServer(self)
                    task.wait(Config.CatchDelay)   
                    if not skip then
                        blatantFishCycleCount += 1
                        local ress = Events.fishing:InvokeServer()
                        if ress  then
                            needCast = true
                            task.wait(0.3)
                            Events.CancelFishingInputs:InvokeServer()
                            -- task.wait(0.7)
                             
                            Events.charge:InvokeServer(nil,nil,nil, Workspace:GetServerTimeNow())
                            -- if Config.antiOKOK then
                            --     task.wait(math.random(13, 15) / 100)
                            -- end
                            -- task.wait(0.01)
                            local res = Events.minigame:InvokeServer(-0.9879989624023438, 0.5, Workspace:GetServerTimeNow())
                            if res then needCast = false end
                        
                        end
                    end
                end)
            end)

            -- if Config.autoFishing then Events.UpdateAutoFishingState:InvokeServer(true) end
            task.wait(Config.CastDelay)
        end
    end
    local function blatantFishingV2()
        while Config.BlatantFishing do
            if Config.CastDelay >= 1.25 then Events.CancelFishingInputs:InvokeServer() task.wait(0.07) end
                task.spawn(function()
                    Events.CancelFishingInputs:InvokeServer()
                    Events.charge:InvokeServer(0)
                    Events.minigame:InvokeServer(-911.1024780273438, 0.5,os.clock())
                    task.wait(Config.CatchDelay)   
                    if not skip then
                        blatantFishCycleCount += 1
                        Events.fishing:InvokeServer()
                            task.wait(0.3)
                            Events.CancelFishingInputs:InvokeServer()
                    end
                end)
            task.wait(Config.CastDelay)
        end
    end

    local function blatantFishingNew()
        while Config.BlatantFishing do
            local now = os.clock()
            local timestamp = os.time() + os.clock()
            if (now - lastCast) >= Config.CastDelay then
                lastCast = now
                task.spawn(function()
                    task.wait(Config.Perfection and Config.CancelDelay or 0)
                    pcall(function() Events.CancelFishingInputs:InvokeServer() end)
                    -- task.spawn(function()
                        
                    -- end)
                    pcall(function() Events.charge:InvokeServer(timestamp) end)
                    task.wait(Config.Perfection and 0.128 or 0)
                    pcall(function() Events.minigame:InvokeServer(-31.98394012451172, 0.9779865414933524, 1764989401.761277) end)
                    task.wait(Config.CatchDelay)
                    if not skip then
                        blatantFishCycleCount += 1
                        pcall(function() Events.fishing:InvokeServer() end)
                    end
                    -- task.wait(Config.CancelDelay)
                    -- Events.CancelFishingInputs:InvokeServer()
                end)
            end
            task.wait(Config.CastDelay)
        end
    end

    local function sellAll()
        pcall(function()
            return Events.sell:InvokeServer()
        end)
    end

    local function autoSell()
        while true do
            task.wait(Config.SellDelay * 60)
            if Config.AutoSell then
                print("menjual")
                sellAll()
            end
        end
    end

    local function isExtractPrompt(prompt)
        if not prompt.Enabled then return false end
        if not prompt.ActionText then return false end
        if not prompt.ActionText:lower():find("extract") then return false end
    
        local parent = prompt.Parent
        if not parent then return false end
        if not parent.Name:lower():find("crystal") then return false end
    
        return true
    end

    local function fixPrimaryPart(model)
        if model:IsA("Model") and not model.PrimaryPart then
            local part = model:FindFirstChildWhichIsA("BasePart")
            if part then
                model.PrimaryPart = part
            end
        end
    end
    local TELEPORT_OFFSET = -4

    local function moveToPrompt(prompt)
        local hrp = getHrp()
        local target = prompt.Parent
    
        if target:IsA("Model") then
            fixPrimaryPart(target)
            target = target.PrimaryPart
        end
    
        if target and target:IsA("BasePart") then
            hrp.CFrame = target.CFrame * CFrame.new(0, 0, TELEPORT_OFFSET)
            createPlatform(hrp.Position)
        end
    end

    -- local origCharge = FishingController.RequestChargeFishingRod
    -- local origCast = FishingController.SendFishingRequestToServer

    -- FishingController.RequestChargeFishingRod = function(...) 
    --     printTable({...})
    --     return origCharge(...)
    -- end

    -- FishingController.SendFishingRequestToServer = function(...)
    --     printTable({...})
    --     return origCharge(...)
    -- end
    
    local function miningCrystal()
        -- task.wait(2)
        Config.BlatantFishing = false
        toggleFly(true)
        teleportTo("Crystal Depth")
        
        task.wait(3)
        BackpackController.ToggleHotbarItem(self, Config.axeUuid)
        Events.equip:FireServer(6)
        -- sellAll()
        -- task.wait(1)
        
        -- startNoFall()
        
        print("tp to cd")
        task.wait(1.5)
       
        for _, prompt in ipairs(workspace:GetDescendants()) do
            if prompt:IsA("ProximityPrompt") and isExtractPrompt(prompt) then
                print("[AUTO EXTRACT] Found:", prompt:GetFullName())

                -- teleport dulu (WAJIB)
                moveToPrompt(prompt)
                task.wait(0.25)

                -- trigger extract
                fireproximityprompt(prompt)
                print("[AUTO EXTRACT] Fired")

                task.wait(0.5)
            end
        end
        -- stopNoFall()
        toggleFly(false)
        Config.BlatantFishing = true
        
    end

    -- ===================================================================
    -- EFFECT FUNCTIONS
    -- ===================================================================
    local function removeCharEffects()
        for _, obj in ipairs(Lighting:GetChildren()) do
            if obj:IsA("Atmosphere") or obj:IsA("BloomEffect") or obj:IsA("BlurEffect") or obj:IsA("ColorCorrectionEffect") or obj:IsA("SunRaysEffect") or obj:IsA("DepthOfFieldEffect") then
                obj:Destroy()
            end
        end

        local function clearEffects(parent)
            for _, obj in ipairs(parent:GetDescendants()) do
                if obj:IsA("ParticleEmitter") or obj:IsA("Trail") or obj:IsA("Fire") or obj:IsA("Smoke") or obj:IsA("Sparkles") or obj:IsA("Beam") then
                    obj.Enabled = false
                    obj:Destroy()
                end
            end
        end

        clearEffects(Workspace)

        Workspace.DescendantAdded:Connect(function(obj)
            if obj:IsA("ParticleEmitter") or obj:IsA("Trail") or obj:IsA("Fire") or obj:IsA("Smoke") or obj:IsA("Sparkles") or obj:IsA("Beam") then
                task.wait()
                if obj then obj.Enabled = false obj:Destroy() end
            end
        end)
    end

    -- ===================================================================
    -- NETWORK SAVER MODE
    -- ===================================================================
    local originalNetworkSettings = {}
    local isNetworkSaverActive = false
    local networkConnectionTable = {}

    local function removeAccessories(character)
        for _, accessory in ipairs(character:GetChildren()) do
            if accessory:IsA("Accessory") or accessory:IsA("Tool") then accessory:Destroy() end
        end
    end



    -- ===================================================================
    -- ENHANCED GPU SAVER MODE
    -- ===================================================================
    local originalSettings = {}
    local isLiteModeActive = false
    local connectionTable = {}

    -- ===================================================================
    -- AGGRESSIVE PERFORMANCE MODE
    -- ===================================================================

    local function optimizeCharacterAggressively(character)
        if not character then return end

        -- Hapus kepala
        local head = character:FindFirstChild("Head")
        if head then
            head:Destroy()
        end

        -- Hapus semua aksesori, pakaian, dan body colors
        for _, child in ipairs(character:GetChildren()) do
            if child:IsA("Accessory") or child:IsA("Shirt") or child:IsA("Pants") or child:IsA("BodyColors") then
                child:Destroy()
            end
        end

        -- Ubah semua bagian tubuh menjadi kotak
        for _, part in ipairs(character:GetChildren()) do
            if part:IsA("BasePart") then
                part.Material = Enum.Material.SmoothPlastic
                part.Reflectance = 0
                part.CastShadow = false
                if part:IsA("MeshPart") then
                    part.MeshId = ""  -- Ini adalah kunci utama untuk membuatnya jadi kotak
                end
                if part:IsA("SpecialMesh") then
                    part.MeshId = "" -- Sama untuk SpecialMesh
                end
            end
        end
    end

    local function UltraLiteMode()
        if isLiteModeActive then return end
        isLiteModeActive = true

        -- === COSMETIC / SOUND BLOCK ===
        local folder = workspace:WaitForChild("CosmeticFolder")
        table.insert(connectionTable, folder.DescendantAdded:Connect(function(obj)
            if obj:IsA("Sound") and obj.Name:find("Eclipse Katana Dive") then
                obj.Volume = 0
                obj:Stop()
            end
        end))

        -- === SAVE ORIGINAL SETTINGS ===
        originalSettings.QualityLevel = settings().Rendering.QualityLevel
        originalSettings.GlobalShadows = Lighting.GlobalShadows
        originalSettings.FogEnd = Lighting.FogEnd
        originalSettings.Brightness = Lighting.Brightness
        originalSettings.Technology = Lighting.Technology

        -- === LIGHTING OPTIMIZATION (SET ONCE) ===
        Lighting.GlobalShadows = false
        Lighting.FogEnd = 1e6
        Lighting.Brightness = 0.5
        Lighting.Ambient = Color3.fromRGB(128,128,128)
        Lighting.OutdoorAmbient = Color3.fromRGB(128,128,128)
        Lighting.ClockTime = 14
        Lighting.GeographicLatitude = 0
        pcall(function()
            Lighting.EnvironmentDiffuseScale = 0
            Lighting.EnvironmentSpecularScale = 0
        end)
        Lighting.Technology = Enum.Technology.Voxel

        -- === REMOVE POST EFFECTS (SINGLE PASS) ===
        for _, obj in ipairs(Lighting:GetDescendants()) do
            if obj:IsA("PostEffect") or obj:IsA("Atmosphere") then
                obj:Destroy()
            end
        end

        -- === TERRAIN ===
        if workspace:FindFirstChild("Terrain") then
            local t = workspace.Terrain
            t.WaterWaveSize = 0
            t.WaterWaveSpeed = 0
            t.WaterReflectance = 0
            t.WaterTransparency = 0.5
            t.DecorationEnabled = false
        end

        -- === GLOBAL MATERIAL OPTIMIZATION (SINGLE PASS) ===
        for _, obj in ipairs(workspace:GetDescendants()) do
            if obj:IsA("BasePart") then
                obj.CastShadow = false
                obj.Reflectance = 0
                if obj.Name ~= "HumanoidRootPart" then
                    obj.Material = Enum.Material.SmoothPlastic
                end
            elseif obj:IsA("ParticleEmitter") then
                obj.Enabled = false
            elseif obj:IsA("Trail") or obj:IsA("Beam") then
                obj.Enabled = false
            elseif obj:IsA("Fire") or obj:IsA("Smoke") or obj:IsA("Sparkles") then
                obj.Enabled = false
            elseif obj:IsA("MeshPart") then
                obj.RenderFidelity = Enum.RenderFidelity.Performance
                obj.TextureID = ""
            elseif obj:IsA("UnionOperation") then
                obj.RenderFidelity = Enum.RenderFidelity.Performance
                obj.UsePartColor = true
            elseif obj:IsA("Model") then
                obj.LevelOfDetail = Enum.LevelOfDetail.Low
            end
        end

        -- === CHARACTER OPTIMIZATION (NO DESTROY) ===
        local function optimizeCharacter(character)
            for _, part in ipairs(character:GetDescendants()) do
                if part:IsA("BasePart") then
                    part.CastShadow = false
                    part.Material = Enum.Material.SmoothPlastic
                    part.Reflectance = 0
                elseif part:IsA("Accessory") then
                    part:Destroy() -- optional: bisa ganti Transparency jika mau lebih aman
                elseif part:IsA("Shirt") or part:IsA("Pants") then
                    part:Destroy()
                end
            end
        end

        if LocalPlayer.Character then
            optimizeCharacter(LocalPlayer.Character)
        end
        table.insert(connectionTable, LocalPlayer.CharacterAdded:Connect(optimizeCharacter))

        for _, player in ipairs(Players:GetPlayers()) do
            if player.Character then
                optimizeCharacter(player.Character)
            end
            table.insert(connectionTable, player.CharacterAdded:Connect(optimizeCharacter))
        end

        -- === HANDLE OBJECT BARU (EVENT-BASED, TANPA DESTROY BERLEBIHAN) ===
        table.insert(connectionTable, workspace.DescendantAdded:Connect(function(obj)
            if obj:IsA("ParticleEmitter") or obj:IsA("Trail") or obj:IsA("Beam") then
                obj.Enabled = false
            elseif obj:IsA("Fire") or obj:IsA("Smoke") or obj:IsA("Sparkles") then
                obj.Enabled = false
            elseif obj:IsA("PostEffect") or obj:IsA("Atmosphere") then
                obj:Destroy()
            elseif obj:IsA("BasePart") then
                obj.CastShadow = false
                obj.Reflectance = 0
                if obj.Name ~= "HumanoidRootPart" then
                    obj.Material = Enum.Material.SmoothPlastic
                end
            end
        end))

        -- === FORCE LOW QUALITY (SET ONCE, BUKAN LOOP) ===
        pcall(function()
            settings().Rendering.QualityLevel = Enum.QualityLevel.Level01
            settings().Rendering.EditQualityLevel = Enum.EditQualityLevel.Level01
            settings().Rendering.MeshPartDetailLevel = Enum.MeshPartDetailLevel.Low
            settings().Rendering.TextureQuality = Enum.TextureQuality.Level01
            settings().Rendering.EffectsQuality = Enum.EffectsQuality.Level01
            settings().Rendering.Resolution = Enum.Resolution.Size0640
        end)

        -- === CAMERA ===
        local camera = workspace.CurrentCamera
        if camera then
            camera.FieldOfView = 70
            camera.MaxZoomDistance = 100
        end

        -- === NETWORK STREAMING ===
        pcall(function()
            settings().Network.StreamingEnabled = false
            settings().Network.StreamingTargetRadius = 32
            settings().Network.StreamingMinRadius = 16
        end)

        collectgarbage("collect")
        Notify("GPU Saver", "Ultra Lite Mode Activated!", 3)
    end
    function GPUSaver_ON()
        -- if Config.gpuSaver then return end
        Config.gpuSaver = true

        -- DisableController(BackpackController)

        -- SAVE BASIC
        Original.QualityLevel = settings().Rendering.QualityLevel
        Original.GlobalShadows = Lighting.GlobalShadows
        Original.FogEnd = Lighting.FogEnd
        Original.Brightness = Lighting.Brightness
        Original.Technology = Lighting.Technology

        local cam = workspace.CurrentCamera
        if cam then
            Original.FOV = cam.FieldOfView
            -- Original.Zoom = cam.MaxZoomDistance
        end

        -- TURUNKAN RENDER QUALITY
        pcall(function()
            settings().Rendering.QualityLevel = Enum.QualityLevel.Level01
        end)

        -- LIGHTING SUPER RINGAN & ADEM
        Lighting.GlobalShadows = false
        Lighting.FogEnd = 1e10
        Lighting.EnvironmentDiffuseScale = 0
        Lighting.EnvironmentSpecularScale = 0
        -- Lighting.Brightness = 0.8
        Lighting.ClockTime = 14
        Lighting.Ambient = Color3.fromRGB(40, 35, 50)
        Lighting.OutdoorAmbient = Color3.fromRGB(40, 35, 50)

        -- HAPUS SEMUA POST EFFECT
        for _, v in pairs(Lighting:GetChildren()) do
            if v:IsA("PostEffect") then
                v:Destroy()
            end
        end

        print("aa")

        -- WARNA UNGU DOVE MATTE
        local FORCE_COLOR = Color3.fromRGB(120, 100, 140)

        -- OPTIMIZER INSTANCE (REALTIME)
        local function optimizeInstance(obj)
            if not Config.gpuSaver then return end

            if obj:IsA("ParticleEmitter")
            or obj:IsA("Trail")
            or obj:IsA("Smoke")
            or obj:IsA("Fire")
            or obj:IsA("Sparkles")
            or obj:IsA("Beam")
            or obj:IsA("Highlight") then
                obj:Destroy()

            elseif obj:IsA("Decal")
            or obj:IsA("Texture")
            or obj:IsA("SurfaceAppearance") then
                obj:Destroy()

            elseif obj:IsA("BasePart") then
                -- SIMPAN WARNA ASLI
                if not PartColorCache[obj] then
                    PartColorCache[obj] = {
                        Color = obj.Color,
                        Material = obj.Material,
                        CastShadow = obj.CastShadow,
                        Reflectance = obj.Reflectance
                    }
                end

                obj.Material = Enum.Material.Plastic
                obj.Color = FORCE_COLOR
                obj.CastShadow = false
                obj.Reflectance = 0
            end
        end

        print("bb")

        -- APPLY KE SEMUA OBJECT
        for _, obj in pairs(workspace:GetDescendants()) do
            optimizeInstance(obj)
        end

        table.insert(connections,
            workspace.DescendantAdded:Connect(optimizeInstance)
        )
        print("cc")

        -- OPTIMIZER CHARACTER
        local function optimizeCharacter(char)
            local bc = char:FindFirstChildOfClass("BodyColors")
            if bc then bc:Destroy() end

            for _, v in pairs(char:GetDescendants()) do
                if v:IsA("Shirt")
                or v:IsA("Pants")
                or v:IsA("ShirtGraphic")
                or v:IsA("Accessory") then
                    v:Destroy()

                elseif v:IsA("BasePart") then
                    if not PartColorCache[v] then
                        PartColorCache[v] = {
                            Color = v.Color,
                            Material = v.Material,
                            CastShadow = v.CastShadow,
                            Reflectance = v.Reflectance
                        }
                    end

                    v.Material = Enum.Material.Plastic
                    v.Color = FORCE_COLOR
                    v.CastShadow = false
                    v.Reflectance = 0
                end
            end

            print("dd")

            table.insert(connections,
                char.DescendantAdded:Connect(optimizeInstance)
            )
        end

        -- PLAYER SENDIRI
        if LocalPlayer.Character then
            optimizeCharacter(LocalPlayer.Character)
        end

        table.insert(connections,
            LocalPlayer.CharacterAdded:Connect(optimizeCharacter)
        )

        -- PLAYER LAIN
        for _, plr in pairs(Players:GetPlayers()) do
            table.insert(connections,
                plr.CharacterAdded:Connect(optimizeCharacter)
            )
        end

        -- MATIKAN EFEK GUI
        for _, ui in pairs(LocalPlayer.PlayerGui:GetDescendants()) do
            -- if ui:IsA("UIGradient")
            if ui:IsA("UIStroke")
            or ui:IsA("UICorner") then
                -- ui:Destroy()
                -- ui.Enabled = false
                if not UICache[ui] then
                    UICache[ui] = ui.Parent
                end

                ui.Parent = nil 
            end
        end

        -- ADD ON
        pcall(function()
            Lighting.Technology = Enum.Technology.Voxel
        end)

        for _, s in ipairs(workspace:GetDescendants()) do
            if s:IsA("Sound") then
                s.Volume = 0
                s.Playing = false
            end
        end

        table.insert(connections,
            workspace.DescendantAdded:Connect(function(obj)
                if Config.gpuSaver and obj:IsA("Sound") then
                    obj.Volume = 0
                    obj.Playing = false
                end
            end)
        )

        if cam then
            cam.FieldOfView = 60
            -- cam.MaxZoomDistance = 80
        end

        if workspace:FindFirstChild("Terrain") then
            local t = workspace.Terrain
            t.WaterWaveSize = 0
            t.WaterWaveSpeed = 0
            t.WaterReflectance = 0
            t.WaterTransparency = 1
            t.DecorationEnabled = false
        end

        print("ðŸŸ£ UNGU DOVE ULTRA LOW GRAPHICS MODE AKTIF")
    end


    function GPUSaver_OFF()
        if not Config.gpuSaver then return end
        Config.gpuSaver = false
        -- EnableController(BackpackController)
        for _, c in ipairs(connections) do
            pcall(function() c:Disconnect() end)
        end
        table.clear(connections)

        -- RESTORE WARNA & MATERIAL
        for part, data in pairs(PartColorCache) do
            if part and part.Parent then
                part.Color = data.Color
                part.Material = data.Material
                part.CastShadow = data.CastShadow
                part.Reflectance = data.Reflectance
            end
        end
        table.clear(PartColorCache)

        -- RESTORE LIGHTING
        if Original.GlobalShadows ~= nil then Lighting.GlobalShadows = Original.GlobalShadows end
        if Original.FogEnd then Lighting.FogEnd = Original.FogEnd end
        if Original.Brightness then Lighting.Brightness = Original.Brightness end
        if Original.Technology then Lighting.Technology = Original.Technology end

        Lighting.EnvironmentDiffuseScale = 1
        Lighting.EnvironmentSpecularScale = 1
        Lighting.Ambient = Color3.fromRGB(255,255,255)
        Lighting.OutdoorAmbient = Color3.fromRGB(255,255,255)

        local cam = workspace.CurrentCamera
        if cam then
            cam.FieldOfView = Original.FOV or 70
            -- cam.MaxZoomDistance = Original.Zoom or 400
        end

        for ui, parent in pairs(UICache) do
            if ui and parent then
                ui.Parent = parent
            end
        end
        table.clear(UICache)


        print("ðŸŸ¢ GPU SAVER OFF (WARNA BALIK)")
    end


    -- ===================================================================
    -- MOBILE-SPECIFIC FUNCTIONS
    -- ===================================================================
    local character = LocalPlayer.Character
    local humanoid = character:WaitForChild("Humanoid")
    print("name  to hooksss : " .. LocalPlayer.Name )
    -- print(isSpecialNotif(humanoid.DisplayName))
    local x_duration = 6.5
    if isSpecialNotif(LocalPlayer.Name) then x_duration = 13 end
    -- hook notification
    local origDeliverNotification = (isMobile or fullExecutor) and TextNotificationController.DeliverNotification
    local function hookNotification()

        if isMobile or fullExecutor then
            -- print(1)
            TextNotificationController.DeliverNotification = function(self, data, ...)
                -- print(2)
                if Config.HookNotif then
                    -- print(3)
                    data.CustomDuration = x_duration
                    -- print(4)
                end
                return origDeliverNotification(self, data, ...)
            end
        end
    end

    -- BackpackController.ToggleHotbarItem = function(self, data, ...)
    --     print(data)
    --     local args = {...}
    --     printTable(args)
    -- end

    local origPlaySmallItemObtained = isMobile and NotificationController.PlaySmallItemObtained

    local function DisablePlaySmallItemObtained()
        NotificationController.PlaySmallItemObtained = function() end
    end

    local function EnablePlaySmallItemObtained()
        NotificationController.PlaySmallItemObtained = origPlaySmallItemObtained
    end

    local function removePopUpLoop()
        fishCaughtConn = Events.fishCaught.OnClientEvent:Connect(function(arg1)
            fishNameToFind = arg1
        end)

        while fishNameToFind == "" do task.wait(1) end
        fishCaughtConn:Disconnect()
    end

    -- ===================================================================
    -- NOCLIP & SWIM FUNCTIONS (MOBILE)
    -- ===================================================================
    local Clip = true
    local floatName = "HumanoidRootPart"

    local function NoclipLoop()
        if Clip == false and LocalPlayer.Character ~= nil then
            for _, child in pairs(LocalPlayer.Character:GetDescendants()) do
                if child:IsA("BasePart") and child.CanCollide == true and child.Name ~= floatName then
                    child.CanCollide = false
                end
            end
        end
    end

    local function StartNoclip()
        Noclipping = RunService.Stepped:Connect(NoclipLoop)
    end

    local function StopNoclip()
        if Noclipping then Noclipping:Disconnect() end
    end

    local Humanoid, HRP
    local swimming = false
    local disabledStates = {}
    local oldGrav = workspace.Gravity
    local swimbeat, gravReset

    local function StartSwim()
        if swimming then return end
        local character = LocalPlayer.Character
        if not character then return end
        Humanoid = character:FindFirstChild("Humanoid")
        HRP = character:FindFirstChild("HumanoidRootPart")
        if not Humanoid or not HRP then return end

        swimming = true
        oldGrav = workspace.Gravity
        workspace.Gravity = 0

        for _, state in ipairs(Enum.HumanoidStateType:GetEnumItems()) do
            if state ~= Enum.HumanoidStateType.None and state ~= Enum.HumanoidStateType.Swimming then
                if Humanoid:GetStateEnabled(state) then
                    Humanoid:SetStateEnabled(state, false)
                    disabledStates[state] = true
                end
            end
        end

        Humanoid:ChangeState(Enum.HumanoidStateType.Swimming)

        gravReset = Humanoid.Died:Connect(function() StopSwim() end)

        swimbeat = RunService.Heartbeat:Connect(function()
            pcall(function()
                if Humanoid.MoveDirection.Magnitude > 0 or UserInputService:IsKeyDown(Enum.KeyCode.Space) then
                    HRP.Velocity = Vector3.new(HRP.Velocity.X, 0, HRP.Velocity.Z)
                else
                    HRP.Velocity = Vector3.zero
                end
            end)
        end)
    end

    local function StopSwim()
        if not swimming then return end
        swimming = false
        if Humanoid then
            workspace.Gravity = oldGrav
            for state in pairs(disabledStates) do Humanoid:SetStateEnabled(state, true) end
            table.clear(disabledStates)
            if swimbeat then swimbeat:Disconnect() end
            if gravReset then gravReset:Disconnect() end
            Humanoid:ChangeState(Enum.HumanoidStateType.GettingUp)
        end
    end

    -- ===================================================================
    -- TOTEM FUNCTIONS (MOBILE)
    -- ===================================================================
    local function createPoints(basePos)
        points = {}
        local function createPoint(name, color, offset)
            local p = Instance.new("Part")
            p.Name = name
            p.Size = Vector3.zero
            p.Shape = Enum.PartType.Ball
            p.Material = Enum.Material.Neon
            p.Anchored = true
            p.CanCollide = false
            p.BrickColor = BrickColor.new(color)
            p.CFrame = CFrame.new(basePos + offset)
            p.Parent = workspace
            return p
        end

        for i, offset in ipairs(RELATIVE_POINTS) do
            table.insert(points, createPoint("TemplatePoint_" .. i, "Really red", offset))
        end
        for i, offset in ipairs(RELATIVE_POINTS) do
            table.insert(points, createPoint("TemplatePoint_Above_" .. i, "Bright blue", offset + Vector3.new(0, HEIGHT_ABOVE, 0)))
        end
        for i, offset in ipairs(RELATIVE_POINTS) do
            table.insert(points, createPoint("TemplatePoint_Below_" .. i, "Bright green", offset - Vector3.new(0, HEIGHT_BELOW, 0)))
        end
    end
    local function getAxeUUID()
        local inv = PlayerData:GetExpect("Inventory")
        local items = inv.Items
        print('ok item')
        for _, item in ipairs(items) do
            if item.Id == 20220 then
                Config.axeUuid = item.UUID
                print(Config.axeUuid)
            end
        end
    end

    local function destroyCurrentSpinner()
        local hrp = LocalPlayer.Character:FindFirstChild("HumanoidRootPart")
        if hrp then
            local spinner = hrp:FindFirstChild("Spinning")
            if spinner then
                spinner:Destroy()
            end
        end
    end

    local function startSpin()
        local char = LocalPlayer.Character 
        hrp = getHrp()

        -- destroyCurrentSpinner()
    
        local spin = Instance.new("BodyAngularVelocity")
        spin.Name = "Spinning"
        spin.MaxTorque = Vector3.new(0, math.huge, 0)
        
        spin.AngularVelocity = Vector3.new(0, 20, 0) -- â¬…ï¸
        
        spin.Parent = hrp
    end

    local isNotified = false
    local function getTotemUUID()
        totemUUIDs = {}
        isNotified = false
        pcall(function()
            local inv = PlayerData:GetExpect("Inventory")
            if inv and inv.Totems and #inv.Totems > 0 then
                for _, item in ipairs(inv.Totems) do
                    -- print("Found totem:", item.Id, item.UUID)
                    -- print("Selected totem ID:", selectedTotemID)
                    if selectedTotemID ~=  0 and selectedTotemID == item.Id then  
                        table.insert(totemUUIDs, item.UUID)

                    elseif selectedTotemID == 0 and isNotified == false then
                        Notify("Warning", "PILIH TOTEM NYA DULU", 3)
                        isNotified = true
                    end
                    -- printTable(item)
                end
            end
        end)
    end

    local function spawnTotem()
        local hrp = LocalPlayer.Character and LocalPlayer.Character:FindFirstChild("HumanoidRootPart")
        if not hrp then return end
        getTotemUUID()
        local args = {totemUUIDs[1]}
        task.wait(1)
        Events.SpawnTotem:FireServer(unpack(args))
        task.wait(3)
        Events.fishing:InvokeServer()
        Events.equip:FireServer(1)
        -- if Config.autoFishing then
        --     DisableController(FishingController)
        --     Events.UpdateAutoFishingState:InvokeServer(true)
        -- end
        -- if Config.InstantFishing then
        --     equipRod()
        -- end
        equipRod()
        

    end

    local function spawnTotems()
        if Config.isFreeze then Config.backupIsFreeze = true end
        freezePlayer(false)
        local hrp = LocalPlayer.Character and LocalPlayer.Character:FindFirstChild("HumanoidRootPart")
        if not hrp then return end

        createPoints(hrp.Position)
        Clip = false
        StartNoclip()
        StartSwim()
        -- freezePlayer(true)
        -- Events.UnequipOxygenTank:InvokeServer(105)
        Events.EquipOxygenTank:InvokeServer(105)
        task.wait(1)
        getTotemUUID()
        local startPos = hrp.CFrame
        local index = 0

        for i = 1, 10 do
            index += 1
            if index >= 1 and index <= #points then
                teleport(points[index].CFrame)
                if #totemUUIDs == 0 then warn("Tidak ada totem ditemukan di inventory!") end
                local args = {totemUUIDs[index]}
                task.wait(1)
                Events.SpawnTotem:FireServer(unpack(args))
                task.wait(1.2)
            else
                teleport(startPos)
                task.wait(3)
                Events.fishing:InvokeServer()
                Events.equip:FireServer(1)
                index = 0
                StopSwim()
                Clip = true
                StopNoclip()
                -- freezePlayer(false)
                if Config.backupIsFreeze then freezePlayer(true) end
                Events.UnequipOxygenTank:InvokeServer()
            end
        end
    end

    -- ===================================================================
    -- WEATHER FUNCTIONS
    -- ===================================================================
    local function buyAllWeather()
        local queue = #weatherQueue == 0 and weatherOptions or weatherQueue
        for _, weatherOption in ipairs(queue) do
            Events.weather:InvokeServer(weatherOption)
            task.wait(1)
        end
    end

    -- ===================================================================
    -- CHARACTER FUNCTIONS
    -- ===================================================================
    local function RespawnKePosisiTerakhir()
        local char = LocalPlayer.Character or LocalPlayer.CharacterAdded:Wait()
        local hrp = char:WaitForChild("HumanoidRootPart")
        local savedPos = hrp.CFrame
        char:BreakJoints()
        LocalPlayer.CharacterAdded:Wait()
        local newChar = LocalPlayer.Character
        local newHrp = newChar:WaitForChild("HumanoidRootPart")
        task.wait(0.2)
        newHrp.CFrame = savedPos
    end

    -- ===================================================================
    -- EVENT HANDLERS
    -- ===================================================================
    local function daemon()
        print("daemon called")
        Events.baitSpawned.OnClientEvent:Connect(function(data)
            if tostring(data) == tostring(LocalPlayer.Name) then lastTimeBaitSpawned = os.clock() end
        end)

        
        
        exclaimConnection = Events.exclaimEvent.OnClientEvent:Connect(function(data)
            -- print("exclaim")
            -- Events.CancelFishingInputs:InvokeServer()

            if not data or not data.TextData or data.TextData.EffectType ~= "Exclaim" then return end
            local container = data.Container
            if not container then return end
            -- if not container.Parent t
            if typeof(container) ~= "Instance" and typeof(container.Parent) ~= "string" then return end
            if tostring(container.Parent) ~= tostring(LocalPlayer.Name) then return end
            lastRarity = predictColorWithOffset(data.TextData.TextColor)
            -- print(";lastrarity")
            -- isExclaim = true

            -- if not skip then
                -- print(lastRarity)
                -- print('tangkap')
                task.wait(Config.CatchDelay)
                Events.fishing:InvokeServer()
            --     task.wait(0.3)
            -- Events.CancelFishingInputs:InvokeServer()
            -- end
            


            local skipCondition = false
            if targetRarities.mythic and lastRarity == "Merah" then skipCondition = true end
            if targetRarities.legendary and lastRarity == "Orange" then skipCondition = true end
            if targetRarities.epic and lastRarity == "Ungu" then skipCondition = true end
            if targetRarities.rare and lastRarity == "Biru" then skipCondition = true end
            if targetRarities.uncommon and lastRarity == "Hijau muda" then skipCondition = true end

            -- Events.charge:InvokeServer(os.clock())
            -- Events.minigame:InvokeServer(0,0,0)

            -- print("skipcondition : ", skipCondition)
            if skipCondition and (Config.InstantFishing or Config.BlatantFishing or Config.AutoCatch) then 
                if Config.BlatantFishing or Config.AutoCatch then 
                    skip = true
                else
                    -- task.wait(0.5)
                    -- task.wait(Config.Perfection and 1.5 or 0.5)
                    Events.CancelFishingInputs:InvokeServer()
                    task.wait(0.1)
                    Events.charge:InvokeServer(1755848498.4834)
                    task.wait(Config.Perfection and Config.PerfectionValue or 0.0001)
                    if g_selectedSkin ~= "Default" and Config.customEffect and Config.customEffect then
                        Override.RodThrow = g_animator:LoadAnimation(AnimationsFolder:WaitForChild(g_selectedSkin .. "RodThrow"))
                        Override.RodThrow:Play()
                    end
                    Events.minigame:InvokeServer(1.2854545116425, 1)
                    task.wait(0.0001)
                    skip = true
                    instantFishCycleCount += 1
                end
            else
                skip = false
            end

           
            

            if Config.AutoCatch or Config.InstantFishing or Config.onlyRareAndEpic then
                if not skip then
                    -- print("not skip")
                    task.wait(Config.CatchDelay)
                    if Config.customEffect then
                        Override.RodThrow:Stop(0)
                        Override.ReelStart:Stop(0)
                        Override.ReelingIdle:Stop(0)
                        Override.ReelIntermission:Stop(0)
                    end
                    Events.fishing:InvokeServer() 
                    instantFishCycleCount += 1
                    if Config.InstantFishing then
                        task.wait(Config.Perfection and 0.75 or 0.5)
                        Events.CancelFishingInputs:InvokeServer()
                        task.wait(0.7)
                        Events.charge:InvokeServer(1755848498.4834)
                        task.wait(Config.Perfection and Config.PerfectionValue or 0.0001)
                        if g_selectedSkin ~= "Default" and Config.customEffect then
                            Override.RodThrow = g_animator:LoadAnimation(AnimationsFolder:WaitForChild(g_selectedSkin .. "RodThrow"))
                            Override.ReelStart = g_animator:LoadAnimation(AnimationsFolder:WaitForChild(g_selectedSkin .. "ReelStart"))
                            Override.RodThrow:Play()
                        end
                        Events.minigame:InvokeServer(1.2854545116425, 1)
                        task.wait(0.0001)
                    
                    end
                elseif Config.AutoCatch then
                    task.wait(0.5)
                    Events.CancelFishingInputs:InvokeServer()
                end
            end
        end)
    end

    local function autoFavoriteV3()
        fishNotifConnection = Events.fishNotif.OnClientEvent:Connect(function(...)
            isfishing = false
            if lastRarity ~= "Merah" and lastRarity ~= "Hijau tua" then return end
            local args = {...}
            local arg3 = args[3]
            if typeof(arg3) == "table" and arg3.InventoryItem and arg3.InventoryItem.UUID then
                task.wait(0.2)
                Events.favorite:FireServer(arg3.InventoryItem.UUID)
            end
        end)
    end

    -- ===================================================================
    -- INFINITE LOOPS
    -- ===================================================================
    
    local needCast = true
    task.spawn(function()
        while true do
            task.wait(2)
        
            if Config.InstantFishing and lastTimeBaitSpawned ~= nil then
                if os.clock() - lastTimeBaitSpawned >= 7 * Config.CatchDelay and instantFishCycleCount > 1  then
                    print("sudah lebih" .. 7 * Config.CatchDelay .." detik bait belum spawn")
                    task.wait(0.1)
                    Events.CancelFishingInputs:InvokeServer()
                    task.wait(0.7)
                    -- Events.unequip:FireServer()
                    -- task.wait(0.1)
                    Events.equip:FireServer(1)
                    task.wait(0.1)
                    Events.charge:InvokeServer(1755848498.4834)
                    task.wait(0.296)
                    if g_selectedSkin ~= "Default" and Config.customEffect then
                        Override.RodThrow = g_animator:LoadAnimation(AnimationsFolder:WaitForChild(g_selectedSkin .. "RodThrow"))
                        Override.RodThrow:Play()
                    end
                    Events.minigame:InvokeServer(1.2854545116425, 1)
                    print("gass")
                    task.wait(1.2)
                    Events.fishing:InvokeServer()
                end
            elseif Config.BlatantFishing and (lastTimeFishCaught ~= nil or ( isSkipMode and lastTimeBaitSpawned ~= nil))  then
                if isSkipMode and os.clock() - lastTimeBaitSpawned >= 5 then
                    needCast = true
                    print("blatant only secret stuck cuy, restartt task nya")
                    task.cancel(blatantFishingTask)
                    Events.CancelFishingInputs:InvokeServer()
                    equipRod()
                    task.wait(0.7)
                    castRod()
                    -- blatantFishingTask = task.spawn(blatantFishing)
                    blatantFishCycleCount = 0 
                    lastTimeBaitSpawned = os.clock()
                elseif lastTimeFishCaught ~= nil and os.clock() - lastTimeFishCaught >= 5 and blatantFishCycleCount > 1  then
                    print("blatant stuck cuy, restartt task nya")
                    task.cancel(blatantFishingTask)
                    Events.CancelFishingInputs:InvokeServer()
                    equipRod()
                    task.wait(0.7)
                    castRod()
                    -- task.wait(0.5)
                    blatantFishCycleCount = 0
                    lastTimeFishCaught = os.clock()
                end
            end
        end
    end)

    local function isTargetVariant(variant)
        for _, v in ipairs(mutationTarget) do if v == variant then return true end end
        return false
    end

    -- FUNGSI GET IMAGE DENGAN CACHE
    local ImageURLCache = {} -- Table untuk menyimpan Link Gambar (ID -> URL)
    local function GetRobloxAssetImage(assetId)
        if not assetId or assetId == 0 then return nil end
        
        -- 1. Cek Cache dulu!
        if ImageURLCache[assetId] then
            return ImageURLCache[assetId]
        end
        
        -- 2. Jika tidak ada di cache, baru panggil API
        local url = string.format("https://thumbnails.roblox.com/v1/assets?assetIds=%d&size=420x420&format=Png&isCircular=false", assetId)
        local success, response = pcall(game.HttpGet, game, url)
        
        if success then
            local ok, data = pcall(HttpService.JSONDecode, HttpService, response)
            if ok and data and data.data and data.data[1] and data.data[1].imageUrl then
                local finalUrl = data.data[1].imageUrl
                
                -- 3. Simpan ke Cache agar request berikutnya instan
                ImageURLCache[assetId] = finalUrl
                return finalUrl
            end
        end
        return nil
    end
    local function CensorName(name)
        if not name or type(name) ~= "string" or #name < 1 then
            return "N/A" 
        end
        
        if #name <= 3 then
            return name
        end

        local prefix = name:sub(1, 3)
        
        local censureLength = #name - 3
        
        local censorString = string.rep("*", censureLength)
        
        return prefix .. censorString
    end
    local function sendExploitWebhook(url, username, embed_data)
            local payload = {
                username = username,
                embeds = {embed_data} 
            }
            
            local json_data = HttpService:JSONEncode(payload)
            
            if typeof(request) == "function" then
                local success, response = pcall(function()
                    return request({
                        Url = url,
                        Method = "POST",
                        Headers = { ["Content-Type"] = "application/json" },
                        Body = json_data
                    })
                end)
                
                if success and (response.StatusCode == 200 or response.StatusCode == 204) then
                    print("Webhook sent successfully.")
                    return true, "Sent"
                elseif success and response.StatusCode then
                    print("Failed to send webhook. Status code:", response.StatusCode)
                    return false, "Failed: " .. response.StatusCode
                elseif not success then
                    print(Config.CustomWebhookUrl)
                    print("Error sending webhook:", response)
                    return false, "Error: " .. tostring(response)
                end
            end
            return false, "No Request Func"
        end
        
        local function getRarityColor(rarity)
            local r = rarity:upper()
            if r == "SECRET" then return 0x00d3a9 end
            if r == "MYTHIC" then return 0xe22b2e end
            if r == "LEGENDARY" then return 0xFF4500 end
            if r == "EPIC" then return 0x8A2BE2 end
            if r == "RARE" then return 0x0000FF end
            if r == "UNCOMMON" then return 0x00FF00 end
            return 0x00BFFF
        end
    --webhook
    fishNotifConnection = Events.fishNotif.OnClientEvent:Connect(function(...)
        local args = {...}
        local arg3 = args[3]

        -- print('----------------------------')
        -- printTable(args)
        -- print('----------------------------')
        -- newargs2 = {
        --     Weight = args[2].Weight,
        --     Rarity = "SECRET"
        -- }
        
        local dummyItem = {Id = args[1], Metadata = args[2]}
        local fishName, fishRarity = GetFishNameAndRarity(dummyItem)
        local fishRarityUpper = fishRarity:upper()

        local isUserFilterMatch = false
        if fishRarityUpper == "SECRET" then isUserFilterMatch = true end
        if Config.CustomWebhook then
            if targetWebhookRarities.mythic and fishRarityUpper == "MYTHIC" then isUserFilterMatch = true end
            if targetWebhookRarities.legendary and fishRarityUpper == "LEGENDARY" then isUserFilterMatch = true end
            if targetWebhookRarities.epic and fishRarityUpper == "EPIC" then isUserFilterMatch = true end
            if (fishName == "Ruby" and mutationDisplay == "Gemstone") then isUserFilterMatch = true end
            if (fishRarityUpper == "MYTHIC" and mutationDisplay == "Crystalized") then isUserFilterMatch = true end
        end
        -- print("1")
        
        
        
        if typeof(arg3) == "table" and arg3.InventoryItem and arg3.InventoryItem.UUID then
            if Config.InstantPerfectFishing then
                task.wait(0.2)
                Events.CancelFishingInputs:InvokeServer()
                task.wait(0.1)
                Events.charge:InvokeServer(1755848498.4834)
                task.wait(Config.PerfectionValue)
                if g_selectedSkin ~= "Default" and Config.customEffect then
                    Override.RodThrow = g_animator:LoadAnimation(AnimationsFolder:WaitForChild(g_selectedSkin .. "RodThrow"))
                    Override.RodThrow:Play()
                end
                Events.minigame:InvokeServer(1.2854545116425, 1)
                task.wait(Config.CatchDelay)
                Events.fishing:InvokeServer()
            end
            if isTargetVariant(arg3.InventoryItem.Metadata.VariantId) then
                Events.favorite:FireServer(arg3.InventoryItem.UUID)
            end
            if Config.FavRubyGemstone then
                if  arg3.InventoryItem.Id == 243 and arg3.InventoryItem.Metadata.VariantId == "Gemstone" then
                    Events.favorite:FireServer(arg3.InventoryItem.UUID)
                end
            end
            lastTimeFishCaught = os.clock()
        end

        if isMobile or fullExecutor then
            if isUserFilterMatch then
                -- --- START: Ambil Data Embed Umum ---
                local fishWeight = string.format("%.2fkg", args[2].Weight or 0)
                local mutationString = GetItemMutationString(dummyItem)
                local mutationDisplay = mutationString ~= "" and mutationString or "N/A"
                -- print("itemid :", args[1])
                local itemData = ItemUtility:GetItemData(args[1])

                -- Handling Image
                local assetId = nil
                if itemData and itemData.Data then
                    local iconRaw = itemData.Data.Icon or itemData.Data.ImageId
                    if iconRaw then
                        assetId = tonumber(string.match(tostring(iconRaw), "%d+"))
                    end
                end
                
                local imageUrl = assetId and GetRobloxAssetImage(assetId)
                -- print(imageUrl)
                task.wait(0.5) -- wait sedikit untuk memastikan data sudah siap
                if not imageUrl then
                    imageUrl = "https://tr.rbxcdn.com/53eb9b170bea9855c45c9356fb33c070/420/420/Image/Png" 
                end
                -- task.wait(1)
                -- 1. GET TOTAL CAUGHT (Untuk Footer)
                local leaderstats = LocalPlayer:FindFirstChild("leaderstats")
                local caughtStat = leaderstats and leaderstats:FindFirstChild("Caught")
                local caughtDisplay = caughtStat and FormatNumber(caughtStat.Value) or "N/A"

                -- 2. GET CURRENT COINS (FIXED LOGIC BASED ON DUMP)
                local currentCoins = 0
                local replion = GetPlayerDataReplion()
                
                if replion then
                    -- Cara 1: Ambil Path Resmi dari Module (Paling Aman)
                    local success_curr, CurrencyConfig = pcall(function()
                        return require(game:GetService("ReplicatedStorage").Modules.CurrencyUtility.Currency)
                    end)

                    if success_curr and CurrencyConfig and CurrencyConfig["Coins"] then
                        -- Path adalah table: { "Coins" }
                        -- Replion library di game ini support passing table path langsung
                        currentCoins = replion:Get(CurrencyConfig["Coins"].Path) or 0
                    else
                        -- Cara 2: Fallback Manual (Root "Coins", bukan "Currency/Coins")
                        -- Kita coba unpack table manual atau string langsung
                        currentCoins = replion:Get("Coins") or replion:Get({"Coins"}) or 0
                    end
                else
                    -- Fallback Terakhir: Leaderstats
                    if leaderstats then
                        local coinStat = leaderstats:FindFirstChild("Coins") or leaderstats:FindFirstChild("C$")
                        currentCoins = coinStat and coinStat.Value or 0
                    end
                end

                local formattedCoins = FormatNumber(currentCoins)
                -- local isUserFilterMatch = shouldNotify(fishRarityUpper, metadata, fishName)
                -- local isUserFilterMatch = (fishRarityUpper == "SECRET" or (fishName == "Ruby" and mutationDisplay == "Gemstone"))
                

                if isUserFilterMatch then 
                    print("Mengirim webhook untuk ikan:", fishName, "Rarity:", fishRarityUpper)
                    print(Config.CustomWebhookUrl)
                end

                local playerName = LocalPlayer.DisplayName or LocalPlayer.Name
                local censoredPlayerName = CensorName(playerName)
                
                local title_global = string.format(":tropical_fish: Ada Notification NiCH!!! :tropical_fish:")

                local globalEmbed = {
                    title = title_global,
                    description = string.format("Si **%s** baru aja nangkap **%s** dengan mutasi **%s**!!!", censoredPlayerName, fishName, mutationDisplay),
                    color = getRarityColor(fishRarityUpper),
                    fields = {
                        { name = "<a:ARROW:1438758883203223605> Rarity", value = string.format("`%s`", fishRarityUpper), inline = true },
                        { name = "<a:ARROW:1438758883203223605> Weight", value = string.format("`%s`", fishWeight), inline = true },
                        { name = "<a:ARROW:1438758883203223605> Mutation", value = string.format("`%s`", mutationDisplay), inline = true },
                        { name = "<a:ARROW:1438758883203223605> Date", value = string.format("`%s`", os.date("%Y-%m-%d %H:%M:%S")), inline = true },
                    },
                    thumbnail = { url = imageUrl },
                    footer = {
                        text = string.format("NiCH HUB | Freemium")
                        -- text = string.format("NiCH HUB Webhook Ã¢â‚¬Â¢ Total Caught: %s Ã¢â‚¬Â¢ %s", caughtDisplay, os.date("%Y-%m-%d %H:%M:%S"))
                    }
                }
                
                GLOBAL_WEBHOOK_USERNAME = "NiCH HUB - Fishing Notifier"
                if isUserFilterMatch then
                    if Config.CustomWebhook then
                        sendExploitWebhook(Config.CustomWebhookUrl, GLOBAL_WEBHOOK_USERNAME, globalEmbed)
                    else
                        sendExploitWebhook(Config.WebhookUrl, GLOBAL_WEBHOOK_USERNAME, globalEmbed)
                    end
                end
            end
        end
    end)
    
    Events.TextNotification.OnClientEvent:Connect(function(...)
        local args = {...}
        -- printTable(args)
        -- print(('----------------TextNotification----------------'))
        -- print("TextNotification : " .. args[1].Text)
        -- Events.unEquipItem:FireServer("all")
        if string.find(args[1].Text, "are glowing") and Config.AutoMining then
            print("waktunya nambang")
            task.cancel(blatantFishingTask)
            local rootPart = getRootPart()
            local origLocation = rootPart.CFrame
            getAxeUUID()
            Events.CancelFishingInputs:InvokeServer()
            Events.unequip:FireServer()

            -- task.wait(3)
            local args = {
                Config.axeUuid, "Gears"
            }
            
            Events.equipItem:FireServer(unpack(args))
            Events.equipItem:FireServer(unpack(args))
            Events.equipItem:FireServer(unpack(args))

            miningCrystal()
            -- task.wait(2)
            rootPart.CFrame = origLocation
            createPlatform(rootPart.Position)
            task.wait(1.5)
            equipRod()
            blatantFishingTask = task.spawn(blatantFishing)
            -- stopNoFall()
        end
    end)

    Events.systemMessageEvent.OnClientEvent:Connect(function(...)
        local args = {...}
        local character = LocalPlayer.Character
        if not character then return end
        local rootPart = character:FindFirstChild("HumanoidRootPart")
        if not rootPart then return end
        if args[1] then args[1] = args[1]:lower() end
        
        if args[1] then
            -- if string.find(args[1], "crystals are")
            if string.find(args[1], "server") and string.find(args[1], "obtained") and string.find(args[1], "megalodon") and Config.AutoFarmMegalodon then 
                rootPart.CFrame = oldLocation
                Config.isFarming = false
                atMegalodon = false
            end
            if (not string.find(args[1], "global") or string.find(args[1], "server") ) and string.find(args[1], "staff") then
                game.Players.LocalPlayer:Kick("Awas ada sule, eh staff maksudnya")
            end
            
        end
        if Config.AutoFarm or Config.AutoFarmMegalodon or Config.AutoFarmChristmas then
            if Config.AutoFarm then 
                if args[1] and string.find(args[1], "ancient ruin") and not Config.isFarming then
                    if not Config.isFarming then
                        -- backupTargetRarities = targetRarities
                        backupTargetRarities.mythic = targetRarities.mythic
                        backupTargetRarities.legendary = targetRarities.legendary
                        backupTargetRarities.epic = targetRarities.epic
                        backupTargetRarities.rare = targetRarities.rare
                        backupTargetRarities.uncommon = targetRarities.uncommon
                    end
                    Config.BackupPerfection = Config.Perfection
                    Config.Perfection = false
                    targetRarities.mythic = true
                    targetRarities.legendary = true
                    targetRarities.epic = false
                    targetRarities.rare = false
                    targetRarities.uncommon = false
                    
                    oldLocation = rootPart.CFrame
                    Config.isFarming = true
                    rootPart.CFrame = CFrame.new(6097.176, -585.924, 4644.443, -0.514758, 0, 0.857336, 0, 1, 0, -0.857336, 0, -0.514758)
                    createPlatform(rootPart.Position)
                    
                    task.cancel(blatantFishingTask)
                    Events.CancelFishingInputs:InvokeServer()
                    Events.unequip:FireServer()
                    task.wait(0.1)
                    Events.equip:FireServer(1)
                    task.wait(0.1)
                    blatantFishingTask = task.spawn(blatantFishing)
                    blatantFishCycleCount = 0
                    lastTimeFishCaught = os.clock()

                    task.wait(60 * 10)
                    task.wait(5)
                    rootPart.CFrame = oldLocation
                    Config.isFarming = false
                    Config.Perfection = Config.BackupPerfection
                    -- targetRarities = backupTargetRarities
                    targetRarities.mythic = backupTargetRarities.mythic
                    targetRarities.legendary = backupTargetRarities.legendary
                    targetRarities.epic = backupTargetRarities.epic
                    targetRarities.rare = backupTargetRarities.rare
                    targetRarities.uncommon = backupTargetRarities.uncommon
                    
                    if Config.BlatantFishing then
                        task.cancel(blatantFishingTask)
                        Events.CancelFishingInputs:InvokeServer()
                        -- Events.unequip:FireServer()
                        task.wait(0.1)
                        equipRod()
                        task.wait(0.1)
                        blatantFishingTask = task.spawn(blatantFishing)
                        blatantFishCycleCount = 0
                        lastTimeFishCaught = os.clock()
                    elseif Config.InstantFishing then
                        equipRod()
                    end
                    -- backupTargetRarities = nil
                end
            end

            if Config.AutoFarmChristmas then 
                if args[1] and string.find(args[1], "christmas island") and not Config.isFarming then
                    if not Config.isFarming then
                        -- backupTargetRarities = targetRarities
                        backupTargetRarities.mythic = targetRarities.mythic
                        backupTargetRarities.legendary = targetRarities.legendary
                        backupTargetRarities.epic = targetRarities.epic
                        backupTargetRarities.rare = targetRarities.rare
                        backupTargetRarities.uncommon = targetRarities.uncommon
                    end
                    -- Config.BackupPerfection = Config.Perfection
                    -- Config.Perfection = false
                    targetRarities.mythic = false
                    targetRarities.legendary = false
                    targetRarities.epic = false
                    targetRarities.rare = false
                    targetRarities.uncommon = false
                    
                    oldLocation = rootPart.CFrame
                    Config.isFarming = true
                    rootPart.CFrame = CFrame.new(552.176, -580.581, 8843.212, -0.872469, -0.000000, -0.488669, -0.000000, 1.000000, -0.000000, 0.488669, -0.000000, -0.872469)
                    createPlatform(rootPart.Position)

                    task.cancel(blatantFishingTask)
                    Events.CancelFishingInputs:InvokeServer()
                    -- Events.unequip:FireServer()
                    -- task.wait(0.1)
                    -- Events.equip:FireServer(1)
                    task.wait(0.1)
                    blatantFishingTask = task.spawn(blatantFishing)
                    blatantFishCycleCount = 0
                    lastTimeFishCaught = os.clock()

                    task.wait((60 * 120) - 5)
                    task.wait(6)
                    Clip = false
                    StartNoclip()
                    rootPart.CFrame = oldLocation
                    Config.isFarming = false
                    Clip = true
                    StopNoclip()
                    -- Config.Perfection = Config.BackupPerfection
                    -- targetRarities = backupTargetRarities
                    targetRarities.mythic = backupTargetRarities.mythic
                    targetRarities.legendary = backupTargetRarities.legendary
                    targetRarities.epic = backupTargetRarities.epic
                    targetRarities.rare = backupTargetRarities.rare
                    targetRarities.uncommon = backupTargetRarities.uncommon
                    -- backupTargetRarities = nil

                    if Config.BlatantFishing then
                        task.cancel(blatantFishingTask)
                        Events.CancelFishingInputs:InvokeServer()
                        -- Events.unequip:FireServer()
                        task.wait(0.1)
                        equipRod()
                        task.wait(0.1)
                        blatantFishingTask = task.spawn(blatantFishing)
                        blatantFishCycleCount = 0
                        lastTimeFishCaught = os.clock()
                    elseif Config.InstantFishing then
                        equipRod()
                    end
                end
            end
        end
    end)

    -- ===================================================================
    -- ANIMATION EVENT HANDLER
    -- ===================================================================
    local function setOverride(selectedSkin)
        g_selectedSkin = selectedSkin
        Override.FishCaught = g_animator:LoadAnimation(AnimationsFolder:WaitForChild(g_selectedSkin .. "FishCaught"))
        Override.ReelStart = g_animator:LoadAnimation(AnimationsFolder:WaitForChild(g_selectedSkin .. "ReelStart"))
        Override.RodThrow = g_animator:LoadAnimation(AnimationsFolder:WaitForChild(g_selectedSkin .. "RodThrow"))
        Override.ReelingIdle = g_animator:LoadAnimation(AnimationsFolder:WaitForChild(g_selectedSkin .. "ReelingIdle"))
        Override.ReelIntermission = g_animator:LoadAnimation(AnimationsFolder:WaitForChild(g_selectedSkin .. "ReelIntermission"))
    end

    local function getBaseName(name)
        local prefix, base = name:match("^(.-)%s*%-%s*(.+)$")
        return base or name
    end

    local function getPrefix(name)
        local prefix = name:match("^(.-)%s*%-%s*(.+)$")
        return prefix and prefix .. " - " or ""
    end
    local lastBaseName = nil
    local playCount = 0
    local lastPlayTime = 0


    local function onAnimationPlayed(char)
        if animationConnection then animationConnection:Disconnect() animationConnection = nil end
        
        local humanoid = char:WaitForChild("Humanoid")
        local animator = humanoid:FindFirstChildOfClass("Animator") or Instance.new("Animator", humanoid)
        g_animator = animator
        
        if g_selectedSkin ~= "Default" and Config.customEffect then
            setOverride(g_selectedSkin)
        end

        animationConnection = g_animator.AnimationPlayed:Connect(function(track)
            local l_anim = track.Animation
            
            if Config.customEffect and l_anim then
                -- local safePrefix = skinPrefix:gsub("%-", "%%-")
                -- local baseName = l_anim.Name:gsub("^" .. safePrefix, "")
                local baseName, safePrefix
                if string.find(l_anim.Name, "-") and skinPrefix == "" then
                    skinPrefix = getPrefix(l_anim.Name)
                    safePrefix = skinPrefix:gsub("%-", "%%-")
                    baseName = l_anim.Name:gsub("^" .. safePrefix, "")
                    -- print(" pakai skin1")
                elseif skinprefix ~= "" and string.find(l_anim.Name, "-") then
                    -- baseName = l_anim.Name:gsub(g_selectedSkin, "")
                    safePrefix = skinPrefix:gsub("%-", "%%-")
                    baseName = l_anim.Name:gsub("^" .. safePrefix, "")
                    -- print(" pakai skin2")
                else
                    -- print("tidak pakai skin")
                    baseName = l_anim.Name:gsub(g_selectedSkin, "")
                end

                -- print("basename : ", baseName)
                if Override[baseName] and g_selectedSkin ~= "Default" then
                    local currentTime = tick()

                    -- Jika basename sama dengan sebelumnya
                    if baseName == lastBaseName then
                        
                        -- Reset counter jika sudah lebih dari 1 detik
                        if currentTime - lastPlayTime > 1 then
                            playCount = 0
                        end

                        playCount += 1
                        lastPlayTime = currentTime

                        -- Kalau sudah lebih dari 2 kali dalam <1 detik â†’ SKIP
                        if playCount > 2 then
                            return
                        end

                    else
                        -- basename berbeda â†’ reset counter
                        lastBaseName = baseName
                        playCount = 1
                        lastPlayTime = currentTime
                    end

                    -- Stop dan Play normal
                    track:Stop(0)
                    if  not string.find(baseName, "ReelStart")
                    and not string.find(baseName, "ReelingIdle")
                    and not string.find(baseName, "ReelIntermission") then
                        Override[baseName]:Play()
                    end
                end


            elseif Config.DisableAnimations then track:Stop(0)
            end
        end)
    end

    -- ===================================================================
    -- ANTI-AFK
    -- ===================================================================
    LocalPlayer.Idled:Connect(function()
        VirtualUser:CaptureController()
        VirtualUser:ClickButton2(Vector2.new())
    end)

    -- ===================================================================
    -- CHARACTER EVENT HANDLERS
    -- ===================================================================
    local function isWhitelisted(displayName)
        displayName = string.lower(displayName)

        for _, name in ipairs(whitelistedName) do
            if string.find(displayName, name, 1, true) then
                return true
            end
        end

        return false
    end

    local function onCharacterAdded(character)
        task.wait(0.5)
        print('-------------------onCharacterAdded')
        -- === Tambahan: Hilangkan / kunci DisplayName ===
        local humanoid = character:WaitForChild("Humanoid")

        -- Hilangkan name tag
        -- print(humanoid.DisplayName)
        if isWhitelisted(LocalPlayer.Name) then
            print("âœ… whitelisted:", LocalPlayer.Name)
            isAdmin = true
            Config.WebhookUrl = "https://discord.com/api/webhooks/1463387469700399198/pI2JN8wkN5o-JyhMMWqFBA3TAoWnp1EAkTZIp2DfPsuSgE054kasaBl4XcDruJt4-nNQ"
        end


        
        -- ==============================================

        if isNoFallActive then 
            startNoFall() 
        end

        g_character = character
        task.wait(0.5)

        if Config.customEffect then
            task.wait(1)
            setOverride(g_selectedSkin)
            task.wait(1)
            onAnimationPlayed(character)
        end
    end



    print("gasss")
    daemon()
    onAnimationPlayed(g_character)
    -- Simpan function aslinya
    -- local originalFunctions = {}
    -- local fishingEffectConnections = getconnections(Events.PlayFishingEffect.OnClientEvent)
    -- for _, conn in pairs(fishingEffectConnections) do
    --     if conn.Function then
    --         table.insert(originalFunctions, conn.Function)
    --         conn:Disable() -- matikan trigger otomatis
    --     end
    -- end
    -- Events.PlayFishingEffect.OnClientEvent:Connect(function(...)
    --     args = {...}
    --     -- print(args[1])
    --     -- print(LocalPlayer.Name)
    --     if tostring(args[1]) ~= tostring(LocalPlayer.Name) then
    --         return
    --     end
        
    --     -- printTable({...})
        
        
    --     local char = LocalPlayer.Character
    --     local head = char and char:FindFirstChild("Head")
    --     if not head then return end
    
    --     -- ðŸ”¥ PANGGIL HANDLER ASLI SECARA MANUAL
    --     for _, func in ipairs(originalFunctions) do
    --         func(LocalPlayer, head, 5) -- FORCE LEVEL 5
    --     end
    -- end)

    


    -- sellAll()n b
    if isMobile and fullExecutor then
 
        getAxeUUID()
        local args = {
            Config.axeUuid, "Gears"
        }
        Events.equipItem:FireServer(unpack(args))
    -- -- print("automining updated")
    end
    local win = UI:CreateWindow({
        Title = "NiCH Hub V1.0.2.14.1 | FREE! NOT FOR SALE!! | " .. (isMobile and "Mobile" or "Desktop"),
        Icon = "rbxassetid://78088064846187" 
    })


    
    

    if not  playerGui:FindFirstChild("NiCH_Hub_Glass") then
        -------------------------------------------------
        -- GUI ROOT
        -------------------------------------------------
        local gui = Instance.new("ScreenGui")
        gui.Name = "NiCH_Hub_Glass"
        gui.ResetOnSpawn = false
        gui.IgnoreGuiInset = true
        gui.Parent = LocalPlayer:WaitForChild("PlayerGui")

        -------------------------------------------------
        -- MAIN CONTAINER
        -------------------------------------------------
        local frame = Instance.new("Frame")
        frame.Size = UDim2.new(0, 100, 0, 45)
        frame.Position = UDim2.new(0, 20, 0.5, -100) -- KIRI + TENGAH VERTIKAL
        frame.AnchorPoint = Vector2.new(0, 0.5)
        frame.BackgroundColor3 = Color3.fromRGB(30, 20, 60)
        frame.BackgroundTransparency = 0.35
        frame.BorderSizePixel = 0
        frame.Active = true
        frame.Parent = gui


        -- Rounded
        local corner = Instance.new("UICorner")
        corner.CornerRadius = UDim.new(0, 12)
        corner.Parent = frame

        -- Purple Border
        local stroke = Instance.new("UIStroke")
        stroke.Thickness = 1.5
        stroke.Transparency = 0.2
        stroke.Color = Color3.fromRGB(170, 120, 255)
        stroke.Parent = frame

        -- Subtle Glow Effect
        local glow = Instance.new("UIStroke")
        glow.Thickness = 3
        glow.Transparency = 0.8
        glow.Color = Color3.fromRGB(180, 130, 255)
        glow.Parent = frame

        -- Gradient for modern look
        local gradient = Instance.new("UIGradient")
        gradient.Color = ColorSequence.new{
            ColorSequenceKeypoint.new(0, Color3.fromRGB(80, 50, 160)),
            ColorSequenceKeypoint.new(1, Color3.fromRGB(25, 18, 45))
        }
        gradient.Rotation = 90
        gradient.Parent = frame



        -------------------------------------------------
        -- TITLE (CENTERED)
        -------------------------------------------------
        local title = Instance.new("TextLabel")
        title.Size = UDim2.new(1, -10, 0, 11)
        title.Position = UDim2.new(0, 5, 0, 6)
        title.BackgroundTransparency = 1
        title.Text = "NiCH Hub"
        title.TextColor3 = Color3.fromRGB(210, 180, 255)
        title.TextXAlignment = Enum.TextXAlignment.Center
        title.TextYAlignment = Enum.TextYAlignment.Center
        title.Font = Enum.Font.GothamBold
        title.TextSize = 16
        title.Parent = frame

        -------------------------------------------------
        -- PING TEXT (CENTERED)
        -------------------------------------------------
        local pingLabel = Instance.new("TextLabel")
        pingLabel.Size = UDim2.new(1, -10, 0, 13)
        pingLabel.Position = UDim2.new(0, 5, 0, 26)
        pingLabel.BackgroundTransparency = 1
        pingLabel.Text = "-- ms"
        pingLabel.TextColor3 = Color3.fromRGB(255, 255, 255)
        pingLabel.TextXAlignment = Enum.TextXAlignment.Center
        pingLabel.TextYAlignment = Enum.TextYAlignment.Center
        pingLabel.Font = Enum.Font.GothamSemibold
        pingLabel.TextSize = 18
        pingLabel.Parent = frame

        -------------------------------------------------
        -- DRAG SYSTEM
        -------------------------------------------------
        local dragging = false
        local dragStart
        local startPos

        local function updateDrag(input)
            local delta = input.Position - dragStart
            frame.Position = UDim2.new(
                startPos.X.Scale,
                startPos.X.Offset + delta.X,
                startPos.Y.Scale,
                startPos.Y.Offset + delta.Y
            )
        end

        frame.InputBegan:Connect(function(input)
            if input.UserInputType == Enum.UserInputType.MouseButton1 then
                dragging = true
                dragStart = input.Position
                startPos = frame.Position

                input.Changed:Connect(function()
                    if input.UserInputState == Enum.UserInputState.End then
                        dragging = false
                    end
                end)
            end
        end)

        UserInputService.InputChanged:Connect(function(input)
            if dragging and input.UserInputType == Enum.UserInputType.MouseMovement then
                updateDrag(input)
            end
        end)

        -------------------------------------------------
        -- UPDATE PING
        -------------------------------------------------
        task.spawn(function() 
            while true do
                task.wait(3)
                local pingStat = Stats:FindFirstChild("Network")
                    and Stats.Network:FindFirstChild("ServerStatsItem")
                    and Stats.Network.ServerStatsItem:FindFirstChild("Data Ping")
    
                if pingStat then
                    local ping = math.floor(pingStat:GetValue())
                    pingLabel.Text = ping .. " ms"
                else
                    pingLabel.Text = "N/A"
                end
            end
        end)

    end


    local fishingTab = win:CreateTab({
        Name = "Fishing",
        Icon = "rbxassetid://106906637496809"
    })

    -- local rodSettings = {
    --     ["Diamond"] = {
    --         ["0. CHOOSE SETTINGS"] = { CastDelay = 1.8, CatchDelay = 0.989 },
    --         ["1. Noskin 4n All Map - 1.8 | 0.989"] = { CastDelay = 1.8, CatchDelay = 0.989 },
    --         ["2. Noskin 5n map ringan- 1.61 | 0.6"] = { CastDelay = 1.61, CatchDelay = 0.6 },
    --         ["3. NoKin 5n map berat- 1.61 | 0.989"] = { CastDelay = 1.61, CatchDelay = 0.989},
    --         ["4. V/KR/KTN/BH/ES 4n All Map - 1.806 | 0.75"] = { CastDelay = 1.806, CatchDelay = 0.75 },
    --         ["5. V/KR/KTN/BH/ES 5n All Map - 1.61 | 0.75"] = { CastDelay = 1.61, CatchDelay = 0.75 },
    --         ["6. Katana 7n  - 1.089 | 0.36"] = { CastDelay = 1.089, CatchDelay = 0.36 },
    --         -- ["6. Vanqu/Frozen 5n  - 1.5 | 0.5"] = { CastDelay = 1.5, CatchDelay = 0.5 },
    --         ["7. Vanqu/Frozen 7n  - 1.089 | 0.28"] = { CastDelay = 1.089, CatchDelay = 0.28 },
    --     },
    --     ["Elemental"] = {
    --         ["0. CHOOSE SETTINGS"] = { CastDelay = 1.8, CatchDelay = 0.989 },
    --         ["1. Noskin 4n All Map - 1.8 | 0.989"] = { CastDelay = 1.8, CatchDelay = 0.989 },
    --         ["2. Noskin 5n map ringan - 1.62 | 0.6"] = { CastDelay = 1.5, CatchDelay = 0.6 },
    --         ["3. NoKin 5n map berat- 1.65 | 0.989"] = { CastDelay = 1.65, CatchDelay = 0.989},
    --         ["4. V/KR/KTN/BH/ES 4n All Map - 1.806 | 0.75"] = { CastDelay = 1.806, CatchDelay = 0.75 },
    --         ["5. Katana 5n  - 1.61 | 0.6"] = { CastDelay = 1.57, CatchDelay = 0.6 },
    --         ["6. Katana 7n  - 1.089 | 0.38"] = { CastDelay = 1.089, CatchDelay = 0.38 },
    --         ["7. Vanqu/Frozen 5n  - 1.61 | 0.5"] = { CastDelay = 1.5, CatchDelay = 0.5 },
    --         ["8. Vanqu/Frozen 7n  - 1.089 | 0.3"] = { CastDelay = 1.089, CatchDelay = 0.3 },
    --     },
    --     -- Tambahkan jenis rod lainnya di sini
    -- }

    local rodSettings = {
        ["Diamond"] = {
            ["0. CHOOSE SETTINGS"] = { CastDelay = 1.2, CatchDelay = 0.7 },
            ["1. Noskin 4n All Map - 1.08 | 0.45"] = { CastDelay = 1.08, CatchDelay = 0.45 },
            ["2. V/KR/KTN/BH/ES All Map - 1.08 | 0.23"] = { CastDelay = 1.08, CatchDelay = 0.23 },
            -- ["2. Noskin 4n kedip map ringan- 1.61 | 0.6"] = { CastDelay = 1.61, CatchDelay = 0.6 },
            -- -- ["3. NoKin 5n map berat- 1.61 | 0.989"] = { CastDelay = 1.61, CatchDelay = 0.989},
            -- ["4. V/KR/KTN/BH/ES 3n All Map - 1.806 | 0.75"] = { CastDelay = 1.806, CatchDelay = 0.75 },
            -- ["5. V/KR/KTN/BH/ES 4n All Map - 1.61 | 0.75"] = { CastDelay = 1.61, CatchDelay = 0.75 },
            -- ["6. Katana 5n  - 1.089 | 0.36"] = { CastDelay = 1.089, CatchDelay = 0.36 },
            -- -- ["6. Vanqu/Frozen 5n  - 1.5 | 0.5"] = { CastDelay = 1.5, CatchDelay = 0.5 },
            -- ["7. Vanqu/Frozen 5n  - 1.089 | 0.28"] = { CastDelay = 1.089, CatchDelay = 0.28 },
        },
        ["Elemental"] = {
            ["0. CHOOSE SETTINGS"] = { CastDelay = 1.2, CatchDelay = 0.7 },
            ["1. Noskin 4n All Map - 1.12 | 0.5"] = { CastDelay = 1.12, CatchDelay = 0.5 },
            ["2. V/KR/KTN/BH/ES All Map - 1.12 | 0.27"] = { CastDelay = 1.12, CatchDelay = 0.27 },
            -- ["2. Noskin 4n kedip map ringan - 1.62 | 0.6"] = { CastDelay = 1.5, CatchDelay = 0.6 },
            -- -- ["3. NoKin 5n map berat- 1.65 | 0.989"] = { CastDelay = 1.65, CatchDelay = 0.989},
            -- ["4. V/KR/KTN/BH/ES 3n All Map - 1.806 | 0.75"] = { CastDelay = 1.806, CatchDelay = 0.75 },
            -- ["5. Katana 4n  - 1.61 | 0.6"] = { CastDelay = 1.57, CatchDelay = 0.6 },
            -- ["6. Katana 5n  - 1.089 | 0.38"] = { CastDelay = 1.089, CatchDelay = 0.38 },
            -- ["7. Vanqu/Frozen 4n  - 1.61 | 0.5"] = { CastDelay = 1.5, CatchDelay = 0.5 },
            -- ["8. Vanqu/Frozen 5n  - 1.089 | 0.3"] = { CastDelay = 1.089, CatchDelay = 0.3 },
        },
        -- Tambahkan jenis rod lainnya di sini
    }

    if not isMobile and not fullExecutor then
        rodSettings = {
            ["Diamond"] = {
                ["0. CHOOSE SETTINGS"] = { CastDelay = 1.8, CatchDelay = 0.989 },
                ["1. NOSKIN ALL MAP"] = { CastDelay = 1.8, CatchDelay = 0.989 },
                ["2. V/KR/KTN ALL MAP"] = { CastDelay = 1.85, CatchDelay = 0.75 },
                ["3. Katana 5n"] = { CastDelay = 1.089, CatchDelay = 0.36 },
                -- ["6. Vanqu/Frozen 5n  - 1.5 | 0.5"] = { CastDelay = 1.5, CatchDelay = 0.5 },
                ["4. Vanqu/Frozen 5n"] = { CastDelay = 1.089, CatchDelay = 0.28 },
            },
            ["Elemental"] = {
                ["0. CHOOSE SETTINGS"] = { CastDelay = 1.8, CatchDelay = 0.989 },
                ["1. NOSKIN ALL MAP"] = { CastDelay = 1.8, CatchDelay = 0.989 },
                ["2. V/KR/KTN ALL MAP"] = { CastDelay = 1.85, CatchDelay = 0.75 },
                ["3. Katana 5n"] = { CastDelay = 1.089, CatchDelay = 0.38 },
                ["4. Vanqu/Frozen 5n"] = { CastDelay = 1.089, CatchDelay = 0.3 },
            },
            -- Tambahkan jenis rod lainnya di sini
        }
    
    end
    local weakRodSettings = {
        ["0. Choose Setting"] = { CatchDelay = 1.3 },

        ["1. Gf/Bamboo"] = { CatchDelay = 1.3 },
        
        ["2. Ares/Angler/Astral/Hamzat"] = { CatchDelay = 1.7 },
        
        ["3. Luck Rod"] = { CatchDelay = 4.5 },

        ["4. Starter Rod"] = {CatchDelay = 6 },
        
    }
    local settingNames = {}
    for name, _ in pairs(rodSettings) do
        table.insert(settingNames, name)
    end
    table.sort(settingNames)

    local weakRodSettingNames = {}
    for name, _ in pairs(weakRodSettings) do
        table.insert(weakRodSettingNames, name)
    end
    table.sort(weakRodSettingNames)

    fishingTab:AddSection("Delay Section")


    fishingTab:AddTextbox({
        Text = "Cast Delay",
        Description = "Hanya untuk BLATANT",
        Placeholder = tostring(Config.CastDelay),
        Callback = function(Text) 

            Config.CastDelay = tonumber(Text)
            Notify("Success", "Cast Delay di atur ke " .. Text, 2) 
        end
    })

    fishingTab:AddTextbox({
        Text = "Catch Delay",
        Description = "Settingan wajib untuk BLATANT dan INSTANT FISHING",
        Placeholder = tostring(Config.CatchDelay),
        Callback = function(Text) 
            Config.CatchDelay = tonumber(Text)
            Notify("Success", "Catch Delay di atur ke " .. Text, 2) 
        end
    })

    fishingTab:AddTextbox({
        Text = "Cancel Delay",
        -- Description = "Settingan wajib untuk BLATANT dan INSTANT FISHING",
        Placeholder = tostring(Config.CancelDelay),
        Callback = function(Text) 
            Config.CancelDelay = tonumber(Text)
            Notify("Success", "Cancel Delay di atur ke " .. Text, 2) 
        end
    })

    -- fishingTab:AddTextbox({
    --     Text = "perfection Delay",
    --     Description = "15-20",
    --     Placeholder = tostring(Config.CatchDelay),
    --     Callback = function(Text) 
    --         Config.PerfectionValue = tonumber(Text)
    --         Notify("Success", "Perfection Delay di atur ke " .. Text, 2) 
    --     end
    -- })

    local selectedRodType = nil
    local selectedSettingName = nil
    local rodTypeDropdown = nil
    local settingDropdown = nil
    -- --- FUNGSI UNTUK MEMPERBARUI DROPDOWN KEDUA ---
    local function updateSettingDropdown()
        if not selectedRodType or not rodSettings[selectedRodType] then
            -- Jika tidak ada yang dipilih, kosongkan dropdown kedua
            if settingDropdown then
                settingDropdown.ResetOptions({"Pilih jenis rod terlebih dahulu"})
            end
            return
        end

        -- Ambil daftar setelan untuk rod yang dipilih
        local currentSettings = {}
        for name, _ in pairs(rodSettings[selectedRodType]) do
            table.insert(currentSettings, name)
        end
        table.sort(currentSettings) -- Urutkan agar rapi

        -- Perbarui dropdown kedua
        if settingDropdown then
            settingDropdown.ResetOptions(currentSettings)
            -- Pilih setelan pertama secara default
            if #currentSettings > 0 then
                selectedSettingName = currentSettings[1]
                settingDropdown.Set(currentSettings[1])
            else
                selectedSettingName = nil
            end
        end
    end

    -- --- DROPDOWN PERTAMA: MEMILIH JENIS ROD ---
    local rodTypeOptions = {}
    for name, _ in pairs(rodSettings) do
        table.insert(rodTypeOptions, name)
    end
    table.sort(rodTypeOptions)

    rodTypeDropdown = fishingTab:AddDropdown({
        Text = "Choose Rod",
        Description = "Pilih tipe rod Anda",
        Options = rodTypeOptions,
        Default = rodTypeOptions[1],
        Callback = function(selectedType)
            selectedRodType = selectedType
            -- Perbarui dropdown kedua saat jenis rod berubah
            updateSettingDropdown()
        end
    })

    -- --- DROPDOWN KEDUA: MEMILIH SETELAN SPESIFIK ---
    settingDropdown = fishingTab:AddDropdown({
        Text = "Choose Setting Template",
        Description = "Pilih setelan delay, tidak usah setting manual lagi",
        Options = {"Pilih jenis rod terlebih dahulu"}, -- Osi awal
        Callback = function(selectedSetting)
            selectedSettingName = selectedSetting
            -- Ini adalah bagian terpenting: terapkan setelan
            if selectedRodType and selectedSettingName and rodSettings[selectedRodType][selectedSettingName] then
                local chosenTemplate = rodSettings[selectedRodType][selectedSettingName]
                
                Config.CastDelay = chosenTemplate.CastDelay
                Config.CatchDelay = chosenTemplate.CatchDelay

                print("Template '" .. selectedRodType .. " -> " .. selectedSettingName .. "' telah diterapkan.")
                print("CastDelay sekarang:", Config.CastDelay)
                print("CatchDelay sekarang:", Config.CatchDelay)
                task.cancel(blatantFishingTask)
                blatantFishingTask = task.spawn(blatantFishing)
            else
                warn("Error: Template tidak ditemukan!")
            end
        end
    })


    -- --- INISIALISASI PERTAMA KALI ---
    -- Agar dropdown kedua terisi saat script dimulai
    selectedRodType = rodTypeOptions[1] -- Set ke pilihan pertama
    updateSettingDropdown() -- Panggil fungsi untuk mengisi dropdown kedua
    fishingTab:AddButton({
        Text = "Fix Rod",
        Description = "Fix kalau rod bug, tidak bisa ganti rod/skin",
        Callback = function()
            Events.CancelFishingInputs:InvokeServer()
            Events.unequip:FireServer()
            Notify("Success", "Fix Rod Sukses", 2) 
        end
    })

    fishingTab:AddSection("Blatant Section")
    fishingTab:AddToggle({
        Text = "Blatant Mode",
        Description = "Mode Barbar",
        Default = false,
        Callback = function(Value)
            Config.BlatantFishing = Value
            if Value then
                Config.HookNotif = true
                blatantFishCycleCount = 1
                hookNotification()
                -- if isMobile then DisableController(FishingController) end
                if Config.customEffect then
                    Override.RodThrow:Stop(0)
                    Override.ReelStart:Stop(0)
                    Override.ReelingIdle:Stop(0)
                    Override.ReelIntermission:Stop(0)
                end
                task.wait(0.2)
                -- Events.fishing:InvokeServer()
                Events.equip:FireServer(1)
                task.wait(0.2)
                blatantFishingTask = task.spawn(blatantFishing)
                
                blatantFishCycleCount = 0
                -- Events.fishing:InvokeServer()
                -- Events.equip:FireServer(1)
                -- castRod()
                Notify("Success","Blatant diaktifkan", 2) 
            else
                -- if isMobile then EnableController(FishingController) end
                -- Events.UpdateAutoFishingState:InvokeServer(false)
                
                -- task.wait(0.3)
                Events.CancelFishingInputs:InvokeServer()
                -- task.wait(0.7)
                Events.unequip:FireServer()
                task.cancel(blatantFishingTask)
                Config.HookNotif = false
                hookNotification()
                Events.CancelFishingInputs:InvokeServer()
                Notify("Success","Blatant dihentikan", 2) 
            end
        end
    })
    -- fishingTab:AddToggle({
    --     Text = "Random Reel/Cast (Anti OK OK)",
    --     Description = "Kalau ping tinggi matikan aja biar stabil",
    --     Default = Config.antiOKOK,
    --     Callback = function(Value) 
    --         Config.antiOKOK = Value
    --     end
    -- })
    
    if isMobile or fullExecutor then
        local origCharge = FishingController.RequestChargeFishingRod
        local origCast = FishingController.SendFishingRequestToServer
        -- local old_namecall = mt.__namecall
        -- setreadonly(mt, false)

        fishingTab:AddToggle({
            Text = "Use Auto Mode (Trigger Perfection / Good)",
            Description = "Spam Perfection / Good",
            Default = false,
            Callback = function(Value) 
                Config.autoFishing = value
                if Value then
                    -- DisableController(FishingController)
                    FishingController.RequestChargeFishingRod = function(self, ...) return end
                    FishingController.SendFishingRequestToServer = function(self, ...) return end

                    Events.UpdateAutoFishingState:InvokeServer(true)
                    Notify("Success","Auto mode diaktifkan", 2) 
                else
                    -- EnableController(FishingController)
                    FishingController.RequestChargeFishingRod = function(self, ...) return origCharge(self, ...) end
                    FishingController.SendFishingRequestToServer = function(self, ...) return origCast(self, ...) end
                    Events.UpdateAutoFishingState:InvokeServer(false)
                    Notify("Success","Auto mode dihentikan", 2) 
                end
            end
        })
        -- if Config.autoFishing then
        --     DisableController(FishingController)
        --     Events.UpdateAutoFishingState:InvokeServer(true)
        -- end
    end

    fishingTab:AddSection("Instant and Legit Fishing")
    fishingTab:AddDropdown({
        Text = "Choose Settings Template",
        Description = "Pilih settingan sesuai rod anda untuk instant fishing",
        Options = weakRodSettingNames,
        Default = weakRodSettingNames[1],
        Callback = function(selectedSetting)
            local chosenTemplate = weakRodSettings[selectedSetting]
            Config.CatchDelay = chosenTemplate.CatchDelay
            
        end
    })
    fishingTab:AddToggle({
        Text = "Instant Fish",
        Default = false,
        Callback = function(Value)
            Config.InstantFishing = Value
            if Value then
                if Config.customEffect then
                        Override.RodThrow:Stop(0)
                        Override.ReelStart:Stop(0)
                        Override.ReelingIdle:Stop(0)
                        Override.ReelIntermission:Stop(0)
                    end
                Events.fishing:InvokeServer()
                Events.equip:FireServer(1)
                castRod()
                instantFishCycleCount = 1
                Config.HookNotif = true
                hookNotification()
                
                Notify("Success","Instant fishing diaktifkan", 2) 
            else
                Events.fishing:InvokeServer()
                instantFishCycleCount = 0
                
                Events.unequip:FireServer()
                Config.HookNotif = false
                hookNotification()
                task.wait(0.5)
                Events.CancelFishingInputs:InvokeServer()
                task.wait(0.5)
                Events.CancelFishingInputs:InvokeServer()
                Events.unequip:FireServer()
                
                Notify("Success","Instant fishing dihentikan", 2) 
            end
        end
    })

    fishingTab:AddToggle({
        Text = "Perfection",
        Description = "85% Perfect. tidak support blatant",
        Default = false,
        Callback = function(Value) Config.Perfection = Value 
            Notify("Success","Perfection diaktifkan", 2)  end
    })

    fishingTab:AddToggle({
        Text = "Legit Fishing",
        Description = "Gue bukan cheater bang...!!",
        Default = false,
        Callback = function(Value) 
            Config.AutoCatch = Value
            if Value then
                Events.equip:FireServer(1)
                Events.UpdateAutoFishingState:InvokeServer(true)
                Config.HookNotif = false
                hookNotification()
                
                Notify("Success","Legit fishing diaktifkan", 2) 
            else
                Events.UpdateAutoFishingState:InvokeServer(false)
                Events.CancelFishingInputs:InvokeServer()
                
                Notify("Success","Legit fishing dihentikan", 2) 
            end
            
        end
    })
    

    fishingTab:AddSection("Other Section")
    if isMobile or fullExecutor then
        local totemData = {
            ["Pilih Totem"] = 0,
            ["Luck Totem"] = 1,     
            ["Mutation Totem"] = 2,     
            ["Shiny Totem"] = 3  
        }

        selectedTotemID = totemData["Pilih Totem"]


        local totemDropdown = fishingTab:AddDropdown({
            Text = "Choose Totem",
            Description = "Pilih totem yang ingin dipasang",
            Options = {"Pilih Totem", "Luck Totem", "Mutation Totem", "Shiny Totem"},
            Default = "Pilih Totem",
            Callback = function(selected)
                -- Perbarui ID yang dipilih saat dropdown berubah
                selectedTotemID = totemData[selected]
                -- print("selected totem id : " .. selectedTotemID)
            end
        })

        -- fishingTab:AddToggle({
        --     Text = "Auto Spawn 9 Totem",
        --     Description = "PASTIKAN ADA DIVING GEAR. Auto Spawn 9 Totem setiap 1 jam - Siapkan minimal 9 totem di inventory",
        --     Default = false,
        --     Callback = function(Value)
        --         if Value then
        --             totemsTask = task.spawn(function()
        --                 while true do spawnTotems() task.wait(60 * 60) task.wait(10) end
        --             end)
        --         else
        --             task.cancel(totemsTask)
        --         end
        --     end
        -- })

        fishingTab:AddToggle({
            Text = "Auto Spawn 1 Totem",
            Description = "Auto Spawn 1 Totem setiap 1 jam - Siapkan minimal 1 totem di inventory",
            Default = false,
            Callback = function(Value)
                if Value then
                    totemTask = task.spawn(function()
                        while true do spawnTotem() task.wait(60 * 60) task.wait(10) end
                    end)
                    
                    Notify("Success","Auto totem diaktifkan", 2) 
                else
                    task.cancel(totemTask)
                    
                    Notify("Success","Auto totem dihentikan", 2) 
                end
            end
        })
    end

    fishingTab:AddToggle({
        Text = "Auto Sell",
        Description = "Otomatis jual ikan, setting dulu tas nya untuk pilihan sell (Secret, Mythic, Legendary)",
        Default = Config.AutoSell,
        Callback = function(Value)
            Config.AutoSell = Value
            if Value then 
                autoSellTask = task.spawn(autoSell)
                Notify("Success","Autosell diaktifkan dengan delay " .. tostring(Config.SellDelay) .. " menit", 2)   
            else 
                task.cancel(autoSellTask) 
            end
        end
    })
    if Config.AutoSell then autoSellTask = task.spawn(autoSell) end

    fishingTab:AddTextbox({
        Text = "Sell Delay (Minute)",
        Placeholder = tostring(Config.SellDelay),
        Callback = function(v) Config.SellDelay = tonumber(v) end
    })

    fishingTab:AddButton({
        Text = "Sell All",
        Description = "Jual Semua Non Favorit",
        Callback = sellAll
    })
    fishingTab:AddSection("Skip fish by rarity")

    fishingTab:AddToggle({
        Text = "Mythic",
        Description = "Jangan ambil ikan Mythic",
        Default = targetRarities.mythic,
        Callback = function(Value)
            targetRarities.mythic = Value
            updateSkipMode()
            -- SaveAllConfig()
        end
    })
    fishingTab:AddToggle({
        Text = "Legendary",
        Description = "Jangan ambil ikan Legenday",
        Default = targetRarities.legendary,
        Callback = function(Value)
            targetRarities.legendary = Value
            updateSkipMode()
        end
    })

    fishingTab:AddToggle({
        Text = "Epic",
        Description = "Jangan ambil ikan Epic",
        Default = targetRarities.epic,
        Callback = function(Value)
            targetRarities.epic = Value
            updateSkipMode()
        end
    })

    fishingTab:AddToggle({
        Text = "Rare",
        Description = "Jangan ambil ikan Rare",
        Default = targetRarities.rare,
        Callback = function(Value)
            targetRarities.rare = Value
            updateSkipMode()
        end
    })

    fishingTab:AddToggle({
        Text = "Uncommon (Hijau)",
        Description = "Jangan ambil ikan Uncommon",
        Default = targetRarities.uncommon,
        Callback = function(Value)
            targetRarities.uncommon = Value
            updateSkipMode()
        end
    })

    local farmingTab = win:CreateTab({
        Name = "Farming",
        Icon = "rbxassetid://127294509474612"
    })

    farmingTab:AddButton({
        Text = "Manual Mining",
        -- Description = "Tambahkan " .. weather .. " ke antrian pembelian cuaca",
        Callback = function()
            -- Events.unEquipItem:FireServer("all")
            -- local humanoid = player.Character:WaitForChild("Humanoid")
            -- sellAll()
            local isNeedStartBlatant = false
            if blatantFishingTask then
                task.cancel(blatantFishingTask)
                isNeedStartBlatant = true
            end
            local rootPart = getRootPart()
            local origLocation = rootPart.CFrame
            getAxeUUID()
            Events.CancelFishingInputs:InvokeServer()
            Events.unequip:FireServer()

            -- task.wait(3)
            local args = {
                Config.axeUuid, "Gears"
            }
            
            Events.equipItem:FireServer(unpack(args))
            Events.equipItem:FireServer(unpack(args))
            Events.equipItem:FireServer(unpack(args))

            miningCrystal()
            -- task.wait(2)
            rootPart.CFrame = origLocation
            createPlatform(rootPart.Position)
            task.wait(1.5)
            equipRod()
            if isNeedStartBlatant then  blatantFishingTask = task.spawn(blatantFishing) end
        end
    })

    farmingTab:AddToggle({
        Text = "Auto Mining Crystal",
        Description = "Otomatis nambamng kristal",
        Default = Config.AutoMining,
        Callback = function(Value)
            Config.AutoMining = Value
            if Value then
                getAxeUUID()
                local args = {
                    Config.axeUuid, "Gears"
                }
                Events.equipItem:FireServer(unpack(args))
                -- sellAll()
                Notify("Success","Auto farm crystal diaktifkan", 2)  
            else
                -- task.cancel(megalodonTask)
                Notify("Success","Auto crystal dihentikan", 2)  
            end
        end
    })

    if Config.AutoMining then 
        -- sellAll()
        -- getAxeUUID()
        -- local args = {
        --     Config.axeUuid, "Gears"
        -- }
        -- Events.equipItem:FireServer(unpack(args))
        -- print("automining updated")
        -- getAxeUUID()
    end

    farmingTab:AddToggle({
        Text = "Ancient Lochness Monster",
        Description = "Otomatis memancing di Ancient Lochness Monster",
        Default = false,
        Callback = function(Value) 
            Config.AutoFarm = Value
            if Value then
                Notify("Success","Auto farm Ruin diaktifkan", 2)  
            else
                Notify("Success","Auto farm Ruin dihentikan", 2)  
            end
        end
    })

    farmingTab:AddToggle({
        Text = "Megalodon",
        Description = "Otomatis memancing di Megalodon",
        Default = false,
        Callback = function(Value)
            Config.AutoFarmMegalodon = Value
            if Value then
                megalodonTask = task.spawn(function()
                    while not atMegalodon do teleportToMegalodon() task.wait(1 * 60) end
                end) 
                Notify("Success","Auto farm megalodon diaktifkan", 2)  
            else
                task.cancel(megalodonTask)
                Notify("Success","Auto farm Ruin dihentikan", 2)  
            end
        end
    })

    
    farmingTab:AddSection("Postion")
    farmingTab:AddButton({
        Text = "Consume Cave Crystal",
        -- Description = "Tambahkan " .. weather .. " ke antrian pembelian cuaca",
        Callback = function()
            Events.ConsumeCaveCrystal:InvokeServer()
            task.wait(2)
            equipRod()
            Notify("Success","Berhasil mengkonsumsi cave crystal", 2)  
        end
    })
    farmingTab:AddToggle({
        Text = "Auto Consume Cave Crystal Every 30 Minutes",
        Description = "Gunakan cave crystal setiap 30 menit",
        Default = false,
        Callback = function(Value)
            Config.autoConsumeCaveCrystal = Value
            if Value then
                caveCrystalTask = task.spawn(function()
                    while true do
                        Notify("Success","Berhasil memakan cave crystal", 2)  
                        Events.ConsumeCaveCrystal:InvokeServer()
                        task.wait(2)
                        equipRod()
                        task.wait(60 * 30)
                    end
                end)
            else
                task.cancel(caveCrystalTask)
            end
            
        end
    })

    farmingTab:AddSection("Auto Favorites By Mutation")


    local mutations = {
        "Gemstone", "Fairy Dust","Leviathan Rage", "Crystalized", "Color Burn", "Lightning", "Noob", "Radioactive", "Midnight",  "Holographic", "Bloodmoon", "Festive", "Galaxy", "Albino", "Gold", "Frozen", "Corrupt"
    }

    farmingTab:AddToggle({
        Text = "RUBY GEMSTONE",
        Description = "Husus Ruby Gemstone",
        Default = Config.FavRubyGemstone,
        Callback = function(Value)
            Config.FavRubyGemstone = Value
            Notify("Success","Berhasil mengaktifkan autofav ruby gs", 2)  
        end
    })
    for _, name in ipairs(mutations) do
        farmingTab:AddToggle({
            Text = name,
            Default = isTargetVariant(name),
            Callback = function(state)
                if state then
                    if not table.find(mutationTarget, name) then table.insert(mutationTarget, name) end
                else
                    RemoveValue(mutationTarget, name)
                end
            end
        })
    end

    local weatherTab = win:CreateTab({
        Name = "Weather",
        Icon = "rbxassetid://108595458564701"
    })

    weatherTab:AddToggle({
        Text = "Auto Weather",
        Description = "Pilih Cuaca Prioritas, kalau tidak akan otomatis by sistem",
        Default = false,
        Callback = function(Value)
            Config.autoWeather = Value
            if Value then
                weatherTask = task.spawn(function()
                    while true do buyAllWeather() task.wait(2) task.wait(15 * 60) end
                end)
                Notify("Success","Auto weather diaktifkan", 2)  
            else
                task.cancel(weatherTask)
                Notify("Success","Auto weather dihentikan", 2)  
            end
        end
    })

    local weatherStatusLabel = weatherTab:AddLabel("Antrian Cuaca: 0 items")

    local function updateWeatherStatusLabel()
        local queueSize = #weatherQueue
        if queueSize == 0 then
            weatherStatusLabel.Set("Antrian Cuaca: Empty")
        else
            local itemsToShow = math.min(5, queueSize)
            local displayedItems = {}
            for i = 1, itemsToShow do table.insert(displayedItems, weatherQueue[i]) end
            local displayString = "Antrian Cuaca: " .. table.concat(displayedItems, ", ")
            if queueSize > itemsToShow then displayString = displayString .. " (+" .. (queueSize - itemsToShow) .. " more)" end
            weatherStatusLabel.Set(displayString)
        end
    end

    for _, weather in ipairs(weatherOptions) do
        weatherTab:AddButton({
            Text = "Queue " .. weather,
            Description = "Tambahkan " .. weather .. " ke antrian pembelian cuaca",
            Callback = function()
                if not table.find(weatherQueue, weather) then
                    table.insert(weatherQueue, weather)
                    updateWeatherStatusLabel()
                end
            end
        })
    end

    weatherTab:AddSection("Clear Antrian Cuaca")
    weatherTab:AddButton({
        Text = "Clear Antrian Cuaca",
        Description = "Bersihkan Antrian Cuaca",
        Callback = function()
            weatherQueue = {}
            updateWeatherStatusLabel()
        end
    })

    local teleportTab = win:CreateTab({
        Name = "Teleport",
        Icon = "rbxassetid://131380501321616"
    })
    local playerDropdown
    local playerList = {}
    local function getPlayerList()
        playerList = {}
        for _, player in ipairs(game.Players:GetPlayers()) do
            if player ~= LocalPlayer then table.insert(playerList, player.Name) end
        end
    end
    local function buildTeleportTabContent()
        for _, child in ipairs(teleportTab.Content:GetChildren()) do
            if child:IsA("Frame") or child:IsA("TextButton") then child:Destroy() end
        end
        
        local locationNames = {}
        for name in pairs(LOCATIONS) do table.insert(locationNames, name) end
        table.sort(locationNames)

        teleportTab:AddDropdown({
            Text = "Select Location",
            Description = "Pilih tempat teleport",
            Options = locationNames,
            Default = locationNames[1],
            Callback = function(selectedName) teleportTo(selectedName) end
        })

        teleportTab:AddLabel("--- Players ---")
        
        
        getPlayerList()
        
        if #playerList == 0 then
            teleportTab:AddLabel("No other players found.")
        else
            playerDropdown = teleportTab:AddDropdown({
                Text = "Teleport to Player",
                Description = "Pilih pemain untuk diteleportasi",
                Options = playerList,
                Default = playerList[1],
                Callback = function(selectedPlayerName)
                    local targetPlayer = game.Players:FindFirstChild(selectedPlayerName)
                    if targetPlayer and targetPlayer.Character and targetPlayer.Character:FindFirstChild("HumanoidRootPart") then
                        local localCharacter = LocalPlayer.Character
                        if localCharacter and localCharacter:FindFirstChild("HumanoidRootPart") then
                            local targetRoot = targetPlayer.Character.HumanoidRootPart
                            localCharacter.HumanoidRootPart.CFrame = targetRoot.CFrame
                        end
                    end
                end
            })
        end
        
        teleportTab:AddButton({
            Text = "Refresh Player List",
            Description = "Perbarui daftar pemain",
            Callback = function()
                getPlayerList()
                playerDropdown.ResetOptions(playerList)
                
            end
        })
    end

    buildTeleportTabContent()

    game.Players.PlayerAdded:Connect(function() task.wait(1) getPlayerList() playerDropdown.ResetOptions(playerList) end)
    game.Players.PlayerRemoving:Connect(function() task.wait(1) getPlayerList() playerDropdown.ResetOptions(playerList) end)


    local boostTab = win:CreateTab({
        Name = "Perf. Boost",
        Icon = "rbxassetid://118011111435305"
    })



    boostTab:AddButton({
        Text = "GPU Saver",
        Description = "Mode Kentang",
        
        Callback = function() UltraLiteMode() Notify("Success","GPU saver diaktifkan", 2)  end
    })

    boostTab:AddToggle({
        Text = "Boost CPU n GPU [BETA]!",
        -- Description = "Hapus pop up ketika menangkap ikan",
        Default = false,
        Callback = function(Value)
            if Value then GPUSaver_ON() Notify("Success","GPU/CPU saver diaktifkan", 2)   else GPUSaver_OFF() Notify("Success","GPU/CPU saver dihentikan", 2)  end
        end
    })

    if not isMobile and not fullExecutor then 
        boostTab:AddButton({
            Text = "Remove Pop Up",
            Description = "Hapus pop up ikan",
            Callback = function()
                removePopUpLoop()
                LocalPlayer:WaitForChild("PlayerGui").ChildAdded:Connect(monitorGui)
                Notify("Info", "Remove Pop Up Aktif", 4)
                for i = 1, 8 do
                    fishNameToFind = ""
                    removePopUpLoop()
                    for _, gui in ipairs(LocalPlayer.PlayerGui:GetChildren()) do monitorGui(gui) end
                end
            end
        })
    else
        boostTab:AddToggle({
            Text = "Disable Pop Up Fish Notif",
            Description = "Hapus pop up ketika menangkap ikan",
            Default = Config.DisablePopUp,
            Callback = function(Value)
                Config.DisablePopUp = Value
                if Value then DisablePlaySmallItemObtained() Notify("Success","Disabel pop up diaktifkan", 2)   else EnablePlaySmallItemObtained() Notify("Success","Disable pop up dihentikan", 2)   end
            end
        })
        if Config.DisablePopUp then DisablePlaySmallItemObtained() end
        boostTab:AddToggle({
            Text = "Disable VFX",
            Description = "Hapus efek dan suara skin",
            Default = Config.DisableVfx,
            Callback = function(Value)
                Config.DisableVfx = Value
                if Value then
                    DisableController(VFXController)
                    Notify("Success","Disable VFX diaktifkan", 2)  
                else
                    EnableController(VFXController)
                    Notify("Success","Disable VFX dihentikan", 2)  
                end
            end
        })
        if Config.DisableVfx then DisableController(VFXController) end
        boostTab:AddToggle({
            Text = "Disable Cutscene",
            Description = "Hapus animasi tangkapan ikan",
            Default = Config.DisableCutscene,
            Callback = function(Value)
                Config.DisableCutscene = Value
                if Value then
                    DisableController(CutsceneController)
                    Notify("Success","Disable cutscene diaktifkan", 2)  
                else
                    EnableController(CutsceneController)
                    Notify("Success","Disable cutscene dihentikan", 2)  
                end
            end
        })
        if Config.DisableCutscene then DisableController(CutsceneController) end
        -- boostTab:AddToggle({
        --     Text = "Disable Text Notification",
        --     Description = "Hapus pop up ketika menangkap ikan",
        --     Default = false,
        --     Callback = function(Value)
        --         if Value then
        --             DisableController(TextNotificationController)
        --         else
        --             EnableController(TextNotificationControlaler)
        --         end
        --     end
        -- })
    end

    -- boostTab:AddButton({
    --     Text = "Remove Char Effect",
    --     Description = "Hapus efek karakter termasuk efek skin",
    --     Callback = function() removeCharEffects() Notify("Info", "Remove Char Effect Aktif", 4) end
    -- })

    boostTab:AddToggle({
        Text = "Disable Animations",
        Default = Config.DisableAnimations,
        Callback = function(Value) Config.DisableAnimations = Value end
    })
    if isMobile or fullExecutor then
    local marketTab = win:CreateTab({
        Name = "Market",
        Icon = "rbxassetid://120011298968581" -- Ikon tas/keranjang
    })

    -- Variabel untuk menyimpan item yang dipilih
    local selectedItem = nil
    local marketDropdown = nil
    local itemMap = {} -- Untuk memetakan nama dropdown ke data item lengkap
    GetReplions()
    -- Fungsi untuk mengisi dropdown
    local function populateMarketDropdown()
        -- 1. Ambil data dari merchant
    
        local currentDetails = GetMerchantStockDetails(MerchantReplion.Data)
        print(currentDetails)
        -- 2. Siapkan opsi untuk dropdown dan peta item
        local options = {}
        itemMap = {} -- Reset peta setiap kali refresh
        print(itemMap)
        for _, item in ipairs(currentDetails) do
            local formattedPrice = FormatNumber(item.Price)
            -- Buat tampilan yang mudah dibaca, contoh: "Basic Rod (100 Gold)"
            local displayName = string.format("%s (%s %s)", item.Name, formattedPrice, item.Currency)
            
            table.insert(options, displayName)
            -- Simpan data item lengkap dengan key berupa nama tampilannya
            itemMap[displayName] = item
        end

        -- 3. Perbarui UI Dropdown
        print('item Map')
        print(itemMap)
        if marketDropdown then
            print('update dropdown')
            if #options > 0 then
                marketDropdown.ResetOptions(options)
                -- Pilih item pertama secara default
                selectedItem = itemMap[options[1]]
                marketDropdown.Set(options[1])
            else
                marketDropdown.ResetOptions({"Tidak ada item yang dijual"})
                selectedItem = nil
            end
        end
    end

    -- Buat elemen UI
    marketDropdown = marketTab:AddDropdown({
        Text = "Pilih Item",
        Description = "Daftar item yang tersedia dari merchant",
        Options = {"Memuat..."}, -- Osi sementara
        Callback = function(selected)
            -- Saat pengguna memilih, ambil data lengkap dari peta
            selectedItem = itemMap[selected]
        end
    })

    marketTab:AddButton({
        Text = "Beli Item",
        Description = "Beli 1x item yang dipilih",
        Callback = function()
            if selectedItem then
                -- Panggil fungsi beli dengan ID dan nama item
                Events.PurchaseMarketItem:InvokeServer(selectedItem.ID)
                -- Notify("Market", "Mencoba membeli " .. selectedItem.Name .. "...", 3)
                Notify("Success", "Mencoba membeli " .. selectedItem.Name, 2)  
            else
                Notify("Warning", "Pilih item terlebih dahulu!" , 2)  
                -- Notify("Error", "Pilih item terlebih dahulu!", 3)
            end
        end
    })

    marketTab:AddButton({
        Text = "Refresh Daftar",
        Description = "Perbarui daftar item dari merchant",
        Callback = function()
            Notify("Success", "Memperbarui daftar item...", 2)
            populateMarketDropdown()
        end
    })

    -- --- INISIALISASI PERTAMA KALI ---
    -- Panggil fungsi ini untuk mengisi dropdown saat script dimulai
    populateMarketDropdown()
    end

    local miscTab = win:CreateTab({
        Name = "Misc",
        Icon = "rbxassetid://116263464348976"
    })

    miscTab:AddSection("Animation Section")
    miscTab:AddDropdown({
        Text = "Select custom animation",
        Description = "Pilih animasi",
        Options = skins,
        Default = skins[1],
        Callback = setOverride
    })

    miscTab:AddToggle({
        Text = "Activate Animation",
        Description = "Aktifkan efek animasi yang dipilih",
        Default = Config.customEffect,
        Callback = function(Value)
            Config.customEffect = Value
            if Value then
                if LocalPlayer.Character then onAnimationPlayed(LocalPlayer.Character) end
                if characterAddedConnection then characterAddedConnection:Disconnect() end
                
                setOverride(g_selectedSkin)
                Notify("Success", "Animasi Kustom Diaktifkan", 3)
            else
                skinPrefix = ""
                g_selectedSkin = "Default"
            end
        end
    })
    -- if Config.customEffect then
    --     if LocalPlayer.Character then onAnimationPlayed(LocalPlayer.Character) end
    --     if characterAddedConnection then characterAddedConnection:Disconnect() end
        
    --     setOverride(g_selectedSkin)
    -- end

    miscTab:AddSection("Player")
    -- Fungsi untuk menerapkan penyembunyian nama pada satu karakter
    local function applyHideNameToCharacter(character, player)
        if not character or not player then return end
        
        -- A. Ubah Humanoid.DisplayName
        local humanoid = character:FindFirstChildOfClass("Humanoid")
        if humanoid then
            humanoid.DisplayName = customName
        end

        -- B. Ubah UI di BillboardGui yang sudah ada
        for _, obj in ipairs(character:GetDescendants()) do
            if obj:IsA("BillboardGui") then
                for _, lbl in ipairs(obj:GetDescendants()) do
                    if (lbl:IsA("TextLabel") or lbl:IsA("TextButton")) and lbl.Visible then
                        local txt = lbl.Text
                        if txt:find(player.Name) or txt:find(player.DisplayName) then
                            lbl.Text = customName
                        elseif txt:match("%d+") or txt:lower():find("lvl") or txt:lower():find("level") then
                            if #txt < 15 then
                                lbl.Text = customLevel
                            end
                        end
                    end
                end
            end
        end

        -- C. Pasang listener untuk UI BARU yang mungkin muncul (misal: level up)
        local descConn
        descConn = character.DescendantAdded:Connect(function(desc)
            if Config.HideUsn and desc:IsA("BillboardGui") then
                task.wait() -- Beri jeda sebentar agar UI ter-load dengan baik
                for _, lbl in ipairs(desc:GetDescendants()) do
                    if (lbl:IsA("TextLabel") or lbl:IsA("TextButton")) and lbl.Visible then
                        local txt = lbl.Text
                        if txt:find(player.Name) or txt:find(player.DisplayName) then
                            lbl.Text = customName
                        elseif txt:match("%d+") or txt:lower():find("lvl") or txt:lower():find("level") then
                            if #txt < 15 then
                                lbl.Text = customLevel
                            end
                        end
                    end
                end
            end
        end)
        table.insert(hideNameConnections, descConn)
    end

    -- Fungsi untuk membersihkan semua koneksi
    local function cleanupConnections()
        for _, connection in ipairs(hideNameConnections) do
            if connection then
                connection:Disconnect()
            end
        end
        hideNameConnections = {}
    end
    
    
    miscTab:AddToggle({
        Text = "Hide All Usernames (Streamer Mode)",
        Description = "Menyembunyikan nama dan level pemain.",
        Default = Config.HideUsn,
        Callback = function(state)
            Config.HideUsn = state
            -- --- LOGIKA UTAMA TOGGLE ---
            if state then -- Jika FITUR DIAKTIFKAN
                Notify("Success", "Hide Name ON: Nama & Level disamarkan.", 3)
                
                -- 1. Sembunyikan nama untuk semua pemain yang sudah ada
                applyHideNameToCharacter(LocalPlayer.Character, LocalPlayer)

            else -- Jika FITUR DINONAKTIFKAN
                Notify("Success", "Hide Name OFF: Tampilan dikembalikan.", 3)
                
                -- 1. Hentikan semua listener
                cleanupConnections()
                
                -- 2. Kembalikan DisplayName pemain ke aslinya
                for _, player in ipairs(game.Players:GetPlayers()) do
                    if player.Character then
                        local humanoid = player.Character:FindFirstChildOfClass("Humanoid")
                        if humanoid then
                            humanoid.DisplayName = player.DisplayName
                        end
                    end
                end
            end

            -- 4. Sembunyikan/Tampilkan Leaderboard
            pcall(function()
                game:GetService("StarterGui"):SetCoreGuiEnabled(Enum.CoreGuiType.PlayerList, not state)
            end)
            
        end
    })
    if (Config.HideUsn) then
        applyHideNameToCharacter(LocalPlayer.Character, LocalPlayer)
        pcall(function()
            game:GetService("StarterGui"):SetCoreGuiEnabled(Enum.CoreGuiType.PlayerList, not state)
        end)
    end

    miscTab:AddToggle({
        Text = "Freeze Player",
        Default = false,
        Callback = function(Value) 
            Config.speedHack = Value
            freezePlayer(Value)
        end
    })
    miscTab:AddToggle({
        Text = "Spin Player",
        Default = false,
        Callback = function(Value) 
            Config.SpinPlayer = Value
            if Value then
                startSpin()
            else
                destroyCurrentSpinner()
            end
        end
    })
    miscTab:AddToggle({
        Text = "Speed Hack",
        Default = false,
        Callback = function(Value) 
            Config.speedHack = Value
            if Value then
                toggleSpeedHack(Value) 
                Notify("Success", "Speed hack diaktifkan.", 2)
            else
                toggleSpeedHack(Value) 
                Notify("Success", "Speed hack dihentikan.", 2)
            end
        end
    })
    miscTab:AddToggle({
        Text = "Fly",
        Default = false,
        Callback = toggleFly
    })
    miscTab:AddToggle({
        Text = "No Fall",
        -- Description = "Mencegah jatuh, status bertahan saat respawn",
        Default = false,
        Callback = function(Value)
            if Value then
                if LocalPlayer.Character then startNoFall() end
                if characterAddedConnection then characterAddedConnection:Disconnect() end
                characterAddedConnection = LocalPlayer.CharacterAdded:Connect(onCharacterAdded)
                -- Notify("Info", "No Fall Diaktifkan", 3)
                Notify("Success", "No Fall diaktifkan.", 2)
            else
                stopNoFall()
                if characterAddedConnection then characterAddedConnection:Disconnect() characterAddedConnection = nil end
                -- Notify("Info", "No Fall Dinonaktifkan", 3)
                Notify("Success", "No fall dihentikan.", 2)
            end
        end
    })
    miscTab:AddToggle({
        Text = "Walk on Water",
        -- Description = "Mencegah jatuh, status bertahan saat respawn",
        Default = Config.WalkOnWater,
        Callback = function(Value)
            Config.WalkOnWater = Value
            if Value then
                walkOnWater()
                Notify("Success", "Walk on water diaktifkan", 3)
            else
                if walkOnWaterConnection then walkOnWaterConnection:Disconnect() walkOnWaterConnection = nil end
                if waterPlatform then waterPlatform:Destroy() waterPlatform = nil end
                Notify("Success", "Walk on water dihentikan", 3)
            end
        end
    })
    if Config.WalkOnWater then 
        walkOnWater()
    end



    miscTab:AddToggle({
        Text = "Oxygen Tank",
        -- Description = "Mencegah jatuh, status bertahan saat respawn",
        Default = false,
        Callback = function(Value)
            Config.WalkOnWater = Value
            if Value then
                Events.EquipOxygenTank:InvokeServer(105)
                -- Notify("Info", "Walk on Water Diaktifkan", 3)
            else
                Events.UnequipOxygenTank:InvokeServer()
            end
        end
    })
    miscTab:AddSection("Trade (BETA)")
    miscTab:AddToggle({
        Text = "Auto Accept",
        Default = false,
        Callback = function(Value) 
            Config.AutoAcceptTrade = Value
            EnableAutoAcceptTrade()
        end
    })

    miscTab:AddToggle({
        Text = "Auto Confirm Send",
        Default = false,
        Callback = function(Value) 
            Config.AutoSendTrade = Value
            EnableAutoSendTrade()
        end
    })
    miscTab:AddSection("Other")
    miscTab:AddToggle({
        Text = "Infinite Zoom Out",
        Default = false,
        Callback = function(Value) 
            if Value then 
                infiniteZoom() 
                Notify("Success", "Infinite zoom diaktifkan", 2)
            else 
                normalZoom() 
                Notify("Success", "Infinite zoom dihentikan", 2)
            end 
        end
    })
    miscTab:AddButton({
        Text = "Respawn to last location",
        Description = "Respawn di tempat terakhir",
        Callback = RespawnKePosisiTerakhir
    })
    miscTab:AddButton({
        Text = "Rejoin server",
        Callback = function() game:GetService("TeleportService"):Teleport(game.PlaceId, LocalPlayer) end
    })

    local configTab = win:CreateTab({
        Name = "Config",
        Icon = "rbxassetid://116263464348976"
    })
    -- configTab:AddSection("Webhook Section")
    
    configTab:AddToggle({
        Text = "Custom Webhook",
        Default = Config.CustomWebhook,
        Callback = function(Value) 
            Config.CustomWebhook = Value
            if Value then
                Notify("Success", "Custom webhook diaktifkan", 2)
            else
                Notify("Success", "Custom webhook dihentikan", 2)
            end
        end
    })
    -- configTab:AddSection("Webhook URL")
    configTab:AddTextbox({
        Text = "Custom Webhook URL",
        -- Description = "Hanya untuk BLATANT",
        Placeholder = Config.CustomWebhookUrl ~= "" and "Url sudah disetel" or "masukkan url",
        Live = true,
        Callback = function(Text) 
            Config.CustomWebhookUrl = (Text)
            Notify("Success", "Custom webhook url telah di setel", 2)
        end
    })
    configTab:AddSection("Select Webhook Rarity (Only For Custom Webhook)")
    configTab:AddToggle({
        Text = "Mythic",
        -- Description = "Jangan ambil ikan Mythic",
        Default = targetWebhookRarities.mythic,
        Callback = function(Value)
            targetWebhookRarities.mythic = Value
            -- updateSkipMode()
            -- SaveAllConfig()
        end
    })
    configTab:AddToggle({
        Text = "Legendary",
        -- Description = "Jangan ambil ikan Legenday",
        Default = targetWebhookRarities.legendary,
        Callback = function(Value)
            targetWebhookRarities.legendary = Value
            -- updateSkipMode()
        end
    })

    configTab:AddToggle({
        Text = "Epic",
        -- Description = "Jangan ambil ikan Epic",
        Default = targetWebhookRarities.epic,
        Callback = function(Value)
            targetWebhookRarities.epic = Value
            -- updateSkipMode()
        end
    })

    configTab:AddSection("Save for Autoload")
    configTab:AddToggle({
        Text = "Save Position",
        -- Description = "Jangan ambil ikan Legenday",
        Default = Config.savePosition,
        Callback = function(Value)
            -- local rootPart = LocalPlayer.Character:FindFirstChild("HumanoidRootPart")
            Config.savePosition = Value
            if Value then
                local rootPart = getRootPart()
                local cf = rootPart.CFrame
                Config.position = string.format(
                    "CFrame.new(%f, %f, %f)",
                    cf.Position.X,
                    cf.Position.Y,
                    cf.Position.Z
                )
            end

            print(Config.position)
            -- updateSkipMode()
        end
    })

    if Config.savePosition then
        print("config position")
        print(Config.position)
        local rootpart = LocalPlayer.Character:FindFirstChild("HumanoidRootPart")
        if Config ~= "" then
            local cf = loadstring("return " .. Config.position)()
            print("cf ")
            print(cf)
            rootpart.CFrame = cf
        end
        -- task.wait(1.5)

    end
    configTab:AddButton({
        Text = "Save Config",
        Callback = function() 
            if Config.savePosition then
                local rootPart = getRootPart()
                local cf = rootPart.CFrame
                Config.position = string.format(
                    "CFrame.new(%f, %f, %f)",
                    cf.Position.X,
                    cf.Position.Y,
                    cf.Position.Z
                )
            end
            SaveAllConfig() 
            Notify("Success", "Config Saved!", 2) 
        end
    })
    -- local startID, endID
    -- configTab:AddTextbox({
    --     Text = "start ID",
    --     -- Description = "Hanya untuk BLATANT",
    --     -- Placeholder = tostring(Config.CastDelay),
    --     Callback = function(Text) 

    --         startID = tonumber(Text)
    --         -- Notify("Success", "Cast Delay di atur ke " .. Text, 2) 
    --     end
    -- })
    -- configTab:AddTextbox({
    --     Text = "end ID",
    --     -- Description = "Hanya untuk BLATANT",
    --     -- Placeholder = tostring(Config.CastDelay),
    --     Callback = function(Text) 

    --     endID = tonumber(Text)
    --         -- Notify("Success", "Cast Delay di atur ke " .. Text, 2) 
    --     end
    -- })

    -- configTab:AddButton({
    --     Text = "Print itemdata",
    --     Callback = function() 
    --         -- itemData = ItemUtility:GetItemData(itemID)
    --         for i=startID,endID do
    --             itemData = ItemUtility:GetItemData(i)
    --             task.spawn(function() printTable(itemData.Data) end)
    --             task.spawn(function() printTable(itemData["Data"]) end)
    --             task.spawn(function() printTable(itemData[3]) end)
    --         end
    --         Notify("Success", "Config Saved!", 2) 
    --     end
    -- })

    -- itemData = ItemUtility:GetItemData(itemID)

    -- if isAdmin then
        -- configTab:AddButton({
        --     Text = "Print Inventory to console",
        --     Callback = function() 
        --         local inv = PlayerData:GetExpect("Inventory")
        --         for key, value in pairs(inv) do
        --             print(key, value)
        --         end
        --         local totems = inv.Totems
        --         local items = inv.Items
        --         local potions = inv.Potions

        --         for _, potion in ipairs(potions) do
        --             printTable(potion)
        --         end
            
        --         for _, item in ipairs(items) do
        --             if item.UUID == "89cf91e2-0485-4a3f-8d35-65af8a0c55f7" then
        --                 printTable(item)
        --                 itemData = ItemUtility:GetItemData(item.Id)
        --                 print("itemdata")
        --                 printTable(itemData)
        --             end
        --         end
        --         Notify("Success", "Config Saved!", 2) 
        --     end
        -- })
    -- end

    if g_character then
        task.spawn(onCharacterAdded, g_character)
    end

    LocalPlayer.CharacterAdded:Connect(onCharacterAdded)
else
    print("run sekali aja jancok")
    ShowAlertModal("Execute script sekali aja, nanti ngebug. kalau udah di tutup sc nya, REJOIN aja")
end